!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).terraDraw={})}(this,function(t){function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(){return n=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},n.apply(this,arguments)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function s(t,e){void 0===e&&(e=9);var i=Math.pow(10,e);return Math.round(t*i)/i}var a=function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(n*n+i*i)},l=function(t){var e=this,i=t.name,n=t.callback,o=t.unregister,r=t.register;this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=i,this.register=function(){e.registered||(e.registered=!0,r(n))},this.unregister=function(){e.register&&(e.registered=!1,o(n))},this.callback=n},c=/*#__PURE__*/function(){function t(t){var e=this;this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance="number"==typeof t.minPixelDragDistance?t.minPixelDragDistance:1,this._minPixelDragDistanceSelecting="number"==typeof t.minPixelDragDistanceSelecting?t.minPixelDragDistanceSelecting:8,this._minPixelDragDistanceDrawing="number"==typeof t.minPixelDragDistanceDrawing?t.minPixelDragDistanceDrawing:8,this._coordinatePrecision="number"==typeof t.coordinatePrecision?t.coordinatePrecision:9,this._listeners=[new l({name:"pointerdown",callback:function(t){if(t.isPrimary){var i=e.getDrawEventFromEvent(t);i&&(e._dragState="pre-dragging",e._lastDrawEvent=i)}},register:function(t){e.getMapContainer().addEventListener("pointerdown",t)},unregister:function(t){e.getMapContainer().removeEventListener("pointerdown",t)}}),new l({name:"pointermove",callback:function(t){if(e._currentModeCallbacks&&t.isPrimary){t.preventDefault();var i=e.getDrawEventFromEvent(t);if(i)if("not-dragging"===e._dragState)e._currentModeCallbacks.onMouseMove(i),e._lastDrawEvent=i;else if("pre-dragging"===e._dragState){if(!e._lastDrawEvent)return;var n={x:e._lastDrawEvent.containerX,y:e._lastDrawEvent.containerY},o={x:i.containerX,y:i.containerY},r=e._currentModeCallbacks.getState(),s=a(n,o);if("drawing"===r?s<e._minPixelDragDistanceDrawing:"selecting"===r?s<e._minPixelDragDistanceSelecting:s<e._minPixelDragDistance)return;e._dragState="dragging",e._currentModeCallbacks.onDragStart(i,function(t){e.setDraggability.bind(e)(t)})}else"dragging"===e._dragState&&e._currentModeCallbacks.onDrag(i,function(t){e.setDraggability.bind(e)(t)})}},register:function(t){e.getMapContainer().addEventListener("pointermove",t)},unregister:function(t){e.getMapContainer().removeEventListener("pointermove",t)}}),new l({name:"contextmenu",callback:function(t){if(e._currentModeCallbacks&&(t.preventDefault(),"not-dragging"===e._dragState||"pre-dragging"===e._dragState)){var i=e.getDrawEventFromEvent(t);if(!i)return;"neither"!==i.button&&e._currentModeCallbacks.onClick(i)}},register:function(t){e.getMapContainer().addEventListener("contextmenu",t)},unregister:function(t){e.getMapContainer().removeEventListener("contextmenu",t)}}),new l({name:"pointerup",callback:function(t){if(e._currentModeCallbacks&&t.isPrimary){var i=e.getDrawEventFromEvent(t);i&&("dragging"===e._dragState?e._currentModeCallbacks.onDragEnd(i,function(t){e.setDraggability.bind(e)(t)}):"not-dragging"!==e._dragState&&"pre-dragging"!==e._dragState||e._currentModeCallbacks.onClick(i),e._dragState="not-dragging",e.setDraggability(!0))}},register:function(t){e.getMapContainer().addEventListener("pointerup",t)},unregister:function(t){e.getMapContainer().removeEventListener("pointerup",t)}}),new l({name:"keyup",callback:function(t){e._currentModeCallbacks&&(e._heldKeys.delete(t.key),e._currentModeCallbacks.onKeyUp({key:t.key,heldKeys:Array.from(e._heldKeys),preventDefault:function(){return t.preventDefault()}}))},register:function(t){e.getMapContainer().addEventListener("keyup",t)},unregister:function(t){e.getMapContainer().removeEventListener("keyup",t)}}),new l({name:"keydown",callback:function(t){e._currentModeCallbacks&&(e._heldKeys.add(t.key),e._currentModeCallbacks.onKeyDown({key:t.key,heldKeys:Array.from(e._heldKeys),preventDefault:function(){return t.preventDefault()}}))},register:function(t){e.getMapContainer().addEventListener("keydown",t)},unregister:function(t){e.getMapContainer().removeEventListener("keydown",t)}})]}var e=t.prototype;return e.getButton=function(t){return-1===t.button?"neither":0===t.button?"left":1===t.button?"middle":2===t.button?"right":"neither"},e.getContainerXYPosition=function(t){var e=this.getMapContainer().getBoundingClientRect();return{containerX:t.clientX-e.left,containerY:t.clientY-e.top}},e.getDrawEventFromEvent=function(t){var e=this.getLngLatFromEvent(t);if(!e)return null;var i=e.lng,n=e.lat,o=this.getContainerXYPosition(t),r=o.containerX,a=o.containerY,l=this.getButton(t),c=Array.from(this._heldKeys);return{lng:s(i,this._coordinatePrecision),lat:s(n,this._coordinatePrecision),containerX:r,containerY:a,button:l,heldKeys:c}},e.register=function(t){this._currentModeCallbacks=t,this._listeners.forEach(function(t){t.register()})},e.unregister=function(){this._listeners.forEach(function(t){t.unregister()}),this.clear()},t}(),h=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,e)||this)._cursor=void 0,i._cursorStyleSheet=void 0,i._lib=void 0,i._map=void 0,i._layers=!1,i._overlay=void 0,i.renderedFeatures=new Set,i._lib=e.lib,i._map=e.map,i._coordinatePrecision="number"==typeof e.coordinatePrecision?e.coordinatePrecision:9,i._overlay=new i._lib.OverlayView,i._overlay.draw=function(){},i._overlay.setMap(i._map),i}o(e,t);var i=e.prototype;return i.circlePath=function(t,e,i){var n=2*i;return"M "+t+" "+e+" m -"+i+", 0 a "+i+","+i+" 0 1,0 "+n+",0 a "+i+","+i+" 0 1,0 -"+n+",0"},i.getLngLatFromEvent=function(t){var e=this._map.getBounds();if(!e)return null;var i=e.getNorthEast(),n=e.getSouthWest(),o=new google.maps.LatLngBounds(n,i),r=this._map.getDiv(),s=t.clientX-r.getBoundingClientRect().left,a=t.clientY-r.getBoundingClientRect().top,l=new google.maps.Point(s,a),c=this._overlay.getProjection();if(!c)return null;var h=c.fromContainerPixelToLatLng(l);return h&&o.contains(h)?{lng:h.lng(),lat:h.lat()}:null},i.getMapContainer=function(){return this._map.getDiv()},i.project=function(t,e){var i=this._map.getBounds();if(void 0===i)throw new Error("cannot get bounds");var n=new this._lib.LatLng(i.getNorthEast().lat(),i.getSouthWest().lng()),o=this._map.getProjection();if(void 0===o)throw new Error("cannot get projection");var r=o.fromLatLngToPoint(n);if(null===r)throw new Error("cannot get projectedNorthWest");var s=o.fromLatLngToPoint({lng:t,lat:e});if(null===s)throw new Error("cannot get projected lng lat");var a=this._map.getZoom();if(void 0===a)throw new Error("cannot get zoom");var l=Math.pow(2,a);return{x:Math.floor((s.x-r.x)*l),y:Math.floor((s.y-r.y)*l)}},i.unproject=function(t,e){var i=this._map.getProjection();if(void 0===i)throw new Error("cannot get projection");var n=this._map.getBounds();if(void 0===n)throw new Error("cannot get bounds");var o=i.fromLatLngToPoint(n.getNorthEast());if(null===o)throw new Error("cannot get topRight");var r=i.fromLatLngToPoint(n.getSouthWest());if(null===r)throw new Error("cannot get bottomLeft");var s=this._map.getZoom();if(void 0===s)throw new Error("zoom get bounds");var a=Math.pow(2,s),l=new google.maps.Point(t/a+r.x,e/a+o.y),c=i.fromPointToLatLng(l);if(null===c)throw new Error("zoom get bounds");return{lng:c.lng(),lat:c.lat()}},i.setCursor=function(t){if(t!==this._cursor){if(this._cursorStyleSheet&&(this._cursorStyleSheet.remove(),this._cursorStyleSheet=void 0),"unset"!==t){var e=this.getMapContainer(),i=document.createElement("style");i.type="text/css",i.innerHTML="#"+e.id+' [aria-label="Map"] { cursor: '+t+" !important; }",document.getElementsByTagName("head")[0].appendChild(i),this._cursorStyleSheet=i}this._cursor=t}},i.setDoubleClickToZoom=function(t){this._map.setOptions(t?{disableDoubleClickZoom:!1}:{disableDoubleClickZoom:!0})},i.setDraggability=function(t){this._map.setOptions({draggable:t})},i.render=function(t,e){var i=this;this._layers?(t.deletedIds.forEach(function(t){var e=i._map.data.getFeatureById(t);e&&(i._map.data.remove(e),i.renderedFeatures.delete(t))}),t.updated.forEach(function(t){if(!t||!t.id)throw new Error("Feature is not valid");var e=i._map.data.getFeatureById(t.id);if(!e)throw new Error("Feature could not be found by Google Maps API");switch(e.forEachProperty(function(t,i){e.setProperty(i,void 0)}),Object.keys(t.properties).forEach(function(i){e.setProperty(i,t.properties[i])}),t.geometry.type){case"Point":var n=t.geometry.coordinates;e.setGeometry(new google.maps.Data.Point(new google.maps.LatLng(n[1],n[0])));break;case"LineString":for(var o=t.geometry.coordinates,r=[],s=0;s<o.length;s++){var a=o[s],l=new google.maps.LatLng(a[1],a[0]);r.push(l)}e.setGeometry(new google.maps.Data.LineString(r));break;case"Polygon":for(var c=t.geometry.coordinates,h=[],d=0;d<c.length;d++){for(var u=[],g=0;g<c[d].length;g++){var p=new google.maps.LatLng(c[d][g][1],c[d][g][0]);u.push(p)}h.push(u)}e.setGeometry(new google.maps.Data.Polygon(h))}}),t.created.forEach(function(t){i.renderedFeatures.add(t.id),i._map.data.addGeoJson(t)})):(this._map.data.addListener("click",function(t){var e=i._listeners.find(function(t){return"click"===t.name});e&&e.callback(t)}),this._map.data.addListener("mousemove",function(t){var e=i._listeners.find(function(t){return"mousemove"===t.name});e&&e.callback(t)})),t.created.forEach(function(t){i.renderedFeatures.add(t.id)});var n={type:"FeatureCollection",features:[].concat(t.created)};this._map.data.addGeoJson(n),this._map.data.setStyle(function(t){var n=t.getProperty("mode"),o=t.getGeometry();if(!o)throw new Error("Google Maps geometry not found");var r=o.getType(),s={};t.forEachProperty(function(t,e){s[e]=t});var a=e[n]({type:"Feature",geometry:{type:r,coordinates:[]},properties:s});switch(r){case"Point":return{clickable:!1,icon:{path:i.circlePath(0,0,a.pointWidth),fillColor:a.pointColor,fillOpacity:1,strokeColor:a.pointOutlineColor,strokeWeight:a.pointOutlineWidth,rotation:0,scale:1}};case"LineString":return{strokeColor:a.lineStringColor,strokeWeight:a.lineStringWidth};case"Polygon":return{strokeColor:a.polygonOutlineColor,strokeWeight:a.polygonOutlineWidth,fillOpacity:a.polygonFillOpacity,fillColor:a.polygonFillColor}}throw Error("Unknown feature type")}),this._layers=!0},i.clearLayers=function(){var t=this;this._layers&&(this._map.data.forEach(function(e){var i=e.getId();t.renderedFeatures.has(i)&&t._map.data.remove(e)}),this.renderedFeatures=new Set,this._layers=!1)},i.clear=function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())},e}(c),d=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,e)||this)._lib=void 0,i._map=void 0,i._panes={},i._container=void 0,i._layers={},i._lib=e.lib,i._map=e.map,i._container=i._map.getContainer(),i}o(e,t);var i=e.prototype;return i.createPaneStyleSheet=function(t,e){var i=document.createElement("style");return i.type="text/css",i.innerHTML=".leaflet-"+t+" {z-index: "+e+";}",document.getElementsByTagName("head")[0].appendChild(i),this._map.createPane(t),i},i.clearPanes=function(){Object.values(this._panes).forEach(function(t){t&&t.remove()}),this._panes={}},i.clearLayers=function(){var t=this;Object.values(this._layers).forEach(function(e){t._map.removeLayer(e)}),this._layers={}},i.styleGeoJSONLayer=function(t){var e=this;return{pointToLayer:function(i,n){if(!i.properties)throw new Error("Feature has no properties");if("string"!=typeof i.properties.mode)throw new Error("Feature mode is not a string");var o=(0,t[i.properties.mode])(i),r=String(o.zIndex);return e._panes[r]||(e._panes[r]=e.createPaneStyleSheet(r,o.zIndex)),e._lib.circleMarker(n,{radius:o.pointWidth,stroke:o.pointOutlineWidth||!1,color:o.pointOutlineColor,weight:o.pointOutlineWidth,fillOpacity:.8,fillColor:o.pointColor,pane:r,interactive:!1})},style:function(i){if(!i||!i.properties)return{};var n=i,o=(0,t[n.properties.mode])(n),r=String(o.zIndex);return e._panes[r]||(e._panes[r]=e.createPaneStyleSheet(r,o.zIndex)),"LineString"===n.geometry.type?{interactive:!1,color:o.lineStringColor,weight:o.lineStringWidth,pane:r}:"Polygon"===n.geometry.type?{interactive:!1,fillOpacity:o.polygonFillOpacity,fillColor:o.polygonFillColor,weight:o.polygonOutlineWidth,stroke:!0,color:o.polygonFillColor,pane:r}:{}}}},i.getLngLatFromEvent=function(t){var e=this.getContainerXYPosition(t),i={x:e.containerX,y:e.containerY};if(isNaN(i.x)||isNaN(i.y))return null;var n=this._map.containerPointToLatLng(i);return isNaN(n.lng)||isNaN(n.lat)?null:{lng:n.lng,lat:n.lat}},i.getMapContainer=function(){return this._container},i.setDraggability=function(t){t?this._map.dragging.enable():this._map.dragging.disable()},i.project=function(t,e){var i=this._map.latLngToContainerPoint({lng:t,lat:e});return{x:i.x,y:i.y}},i.unproject=function(t,e){var i=this._map.containerPointToLatLng({x:t,y:e});return{lng:i.lng,lat:i.lat}},i.setCursor=function(t){"unset"===t?this.getMapContainer().style.removeProperty("cursor"):this.getMapContainer().style.cursor=t},i.setDoubleClickToZoom=function(t){t?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()},i.render=function(t,e){var i=this;t.created.forEach(function(t){i._layers[t.id]=i._lib.geoJSON(t,i.styleGeoJSONLayer(e)),i._map.addLayer(i._layers[t.id])}),t.deletedIds.forEach(function(t){i._map.removeLayer(i._layers[t])}),t.updated.forEach(function(t){i._map.removeLayer(i._layers[t.id]),i._layers[t.id]=i._lib.geoJSON(t,i.styleGeoJSONLayer(e)),i._map.addLayer(i._layers[t.id])})},i.clear=function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers(),this.clearPanes())},e}(c),u=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,e)||this)._nextRender=void 0,i._map=void 0,i._container=void 0,i._rendered=!1,i.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},i._map=e.map,i._container=i._map.getContainer(),i}o(e,t);var i=e.prototype;return i.clearLayers=function(){var t=this;this._rendered&&(["point","linestring","polygon"].forEach(function(e){var i="td-"+e.toLowerCase();t._map.removeLayer(i),"polygon"===e&&t._map.removeLayer(i+"-outline"),t._map.removeSource(i)}),this._rendered=!1)},i._addGeoJSONSource=function(t,e){this._map.addSource(t,{type:"geojson",data:{type:"FeatureCollection",features:e},tolerance:0})},i._addFillLayer=function(t){return this._map.addLayer({id:t,source:t,type:"fill",paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})},i._addFillOutlineLayer=function(t,e){var i=this._map.addLayer({id:t+"-outline",source:t,type:"line",paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}});return e&&this._map.moveLayer(t,e),i},i._addLineLayer=function(t,e){var i=this._map.addLayer({id:t,source:t,type:"line",paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}});return e&&this._map.moveLayer(t,e),i},i._addPointLayer=function(t,e){var i=this._map.addLayer({id:t,source:t,type:"circle",paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}});return e&&this._map.moveLayer(t,e),i},i._addLayer=function(t,e,i){"Point"===e&&this._addPointLayer(t,i),"LineString"===e&&this._addLineLayer(t,i),"Polygon"===e&&(this._addFillLayer(t),this._addFillOutlineLayer(t,i))},i._addGeoJSONLayer=function(t,e){var i="td-"+t.toLowerCase();return this._addGeoJSONSource(i,e),this._addLayer(i,t),i},i._setGeoJSONLayerData=function(t,e){var i="td-"+t.toLowerCase();return this._map.getSource(i).setData({type:"FeatureCollection",features:e}),i},i.getEmptyGeometries=function(){return{points:[],linestrings:[],polygons:[]}},i.updateChangedIds=function(t){var e=this;[].concat(t.updated,t.created).forEach(function(t){"Point"===t.geometry.type?e.changedIds.points=!0:"LineString"===t.geometry.type?e.changedIds.linestrings=!0:"Polygon"===t.geometry.type&&(e.changedIds.polygons=!0)}),t.deletedIds.length>0&&(this.changedIds.deletion=!0),0===t.created.length&&0===t.updated.length&&0===t.deletedIds.length&&(this.changedIds.styling=!0)},i.getLngLatFromEvent=function(t){var e=this.getMapContainer().getBoundingClientRect();return this.unproject(t.clientX-e.left,t.clientY-e.top)},i.getMapContainer=function(){return this._container},i.setDraggability=function(t){t?(this._map.dragRotate.enable(),this._map.dragPan.enable()):(this._map.dragRotate.disable(),this._map.dragPan.disable())},i.project=function(t,e){var i=this._map.project({lng:t,lat:e});return{x:i.x,y:i.y}},i.unproject=function(t,e){var i=this._map.unproject({x:t,y:e});return{lng:i.lng,lat:i.lat}},i.setCursor=function(t){var e=this._map.getCanvas();"unset"===t?e.style.removeProperty("cursor"):e.style.cursor=t},i.setDoubleClickToZoom=function(t){t?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()},i.render=function(t,e){var i=this;this.updateChangedIds(t),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(function(){for(var n=[].concat(t.created,t.updated,t.unchanged),o=i.getEmptyGeometries(),r=function(t){var i=n[t];Object.keys(e).forEach(function(t){var n=i.properties;if(n.mode===t){var r=e[t](i);"Point"===i.geometry.type?(n.pointColor=r.pointColor,n.pointOutlineColor=r.pointOutlineColor,n.pointOutlineWidth=r.pointOutlineWidth,n.pointWidth=r.pointWidth,o.points.push(i)):"LineString"===i.geometry.type?(n.lineStringColor=r.lineStringColor,n.lineStringWidth=r.lineStringWidth,o.linestrings.push(i)):"Polygon"===i.geometry.type&&(n.polygonFillColor=r.polygonFillColor,n.polygonFillOpacity=r.polygonFillOpacity,n.polygonOutlineColor=r.polygonOutlineColor,n.polygonOutlineWidth=r.polygonOutlineWidth,o.polygons.push(i))}})},s=0;s<n.length;s++)r(s);var a=o.points,l=o.linestrings,c=o.polygons;if(i._rendered){var h,d=i.changedIds.deletion||i.changedIds.styling,u=d||i.changedIds.linestrings,g=d||i.changedIds.polygons;(d||i.changedIds.points)&&(h=i._setGeoJSONLayerData("Point",a)),u&&i._setGeoJSONLayerData("LineString",l),g&&i._setGeoJSONLayerData("Polygon",c),h&&i._map.moveLayer(h)}else i._addGeoJSONLayer("Point",a),i._addGeoJSONLayer("LineString",l),i._addGeoJSONLayer("Polygon",c),i._rendered=!0;i.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}})},i.clear=function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())},e}(c),g=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,e)||this).mapboxglAdapter=void 0,i.mapboxglAdapter=new u(e),i}o(e,t);var i=e.prototype;return i.register=function(t){this.mapboxglAdapter.register(t)},i.unregister=function(){this.mapboxglAdapter.unregister()},i.getLngLatFromEvent=function(t){return this.mapboxglAdapter.getLngLatFromEvent(t)},i.getMapContainer=function(){return this.mapboxglAdapter.getMapContainer()},i.setDraggability=function(t){this.mapboxglAdapter.setDraggability(t)},i.project=function(t,e){return this.mapboxglAdapter.project(t,e)},i.unproject=function(t,e){return this.mapboxglAdapter.unproject(t,e)},i.setCursor=function(t){this.mapboxglAdapter.setCursor(t)},i.setDoubleClickToZoom=function(t){this.mapboxglAdapter.setDoubleClickToZoom(t)},i.render=function(t,e){this.mapboxglAdapter.render(t,e)},i.clear=function(){this.mapboxglAdapter.clear()},e}(c);function p(){throw new Error("Unimplemented abstract method.")}let f=0;function y(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}class v{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=y(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new v({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return p()}getImage(t){return p()}getHitDetectionImage(){return p()}getPixelRatio(t){return 1}getImageState(){return p()}getImageSize(){return p()}getOrigin(){return p()}getSize(){return p()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=y(t)}listenImageChange(t){p()}load(){p()}unlistenImageChange(t){p()}}var m=v;const _={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class C extends Error{constructor(t){const e=_[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}var P=C;function S(t,e,i){return Math.min(Math.max(t,e),i)}const w=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,x=/^([a-z]*)$|^hsla?\(.*\)$/i,E=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let i=0;for(const n in t)0==(3&i++)&&(delete t[n],--e)}n=function(t){let e,i,n,o,r;if(x.exec(t)&&(t=function(t){const e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}(t)),w.exec(t)){const s=t.length-1;let a;a=s<=4?1:2;const l=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),i=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),o=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,i=(i<<4)+i,n=(n<<4)+n,l&&(o=(o<<4)+o)),r=[e,i,n,o/255]}else t.startsWith("rgba(")?(r=t.slice(5,-1).split(",").map(Number),M(r)):t.startsWith("rgb(")?(r=t.slice(4,-1).split(",").map(Number),r.push(1),M(r)):function(t,e){throw new P(14)}();return r}(i),t[i]=n,++e}return n}}();function M(t){return t[0]=S(t[0]+.5|0,0,255),t[1]=S(t[1]+.5|0,0,255),t[2]=S(t[2]+.5|0,0,255),t[3]=S(t[3],0,1),t}function b(t){return Array.isArray(t)?function(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+i+","+n+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}(t):t}const D="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"";D.includes("firefox"),D.includes("safari")&&!D.includes("chrom")&&(D.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(D)),D.includes("webkit")&&D.includes("edge"),D.includes("macintosh");const I="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope;function k(t,e,i,n){let o;return o=i&&i.length?i.shift():I?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(o.width=t),e&&(o.height=e),o.getContext("2d",n)}!function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}}();var O=class{constructor(t){this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},F=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function L(){}function W(t){for(const e in t)delete t[e]}var A=class extends F{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e="string"==typeof t,i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const o=e?new O(t):t;o.target||(o.target=this.eventTarget_||this);const r=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});let a;i in r||(r[i]=0,s[i]=0),++r[i];for(let t=0,e=n.length;t<e;++t)if(a="handleEvent"in n[t]?n[t].handleEvent(o):n[t].call(this,o),!1===a||o.propagationStopped){a=!1;break}if(0==--r[i]){let t=s[i];for(delete s[i];t--;)this.removeEventListener(i,L);delete r[i]}return a}disposeInternal(){this.listeners_&&W(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const n=i.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=L,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t]))}}};function G(t,e,i,n,o){if(n&&n!==t&&(i=i.bind(n)),o){const n=i;i=function(){t.removeEventListener(e,i),n.apply(this,arguments)}}const r={target:t,type:e,listener:i};return t.addEventListener(e,i),r}function B(t,e,i,n){return G(t,e,i,n,!0)}function N(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),W(t))}var j=class extends A{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent("change")}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let o=0;o<i;++o)n[o]=G(this,t[o],e);return n}return G(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let o=0;o<n;++o)i[o]=B(this,t[o],e)}else i=B(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)!function(t){if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)N(t[e]);else N(t)}(i);else if(Array.isArray(t))for(let i=0,n=t.length;i<n;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}};class V extends O{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const R="#000",T="round";new class extends j{constructor(t){super(),this.ol_uid||(this.ol_uid=String(++f)),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new V(i,t,e)),i="propertychange",this.hasListener(i)&&this.dispatchEvent(new V(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const i=n[t];n[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],function(t){let e;for(e in t)return!1;return!e}(this.values_)&&(this.values_=null),e||this.notify(t,i)}}};class U extends m{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new U({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=k(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return 2}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||Infinity===this.points_||"bevel"!==t&&"miter"!==t)return e;let n=this.radius_,o=void 0===this.radius2_?n:this.radius2_;if(n<o){const t=n;n=o,o=t}const r=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),s=o*Math.sin(r),a=n-Math.sqrt(o*o-s*s),l=Math.sqrt(s*s+a*a),c=l/s;if("miter"===t&&c<=i)return c*e;const h=e/2/c,d=e/2*(a/l),u=Math.sqrt((n+h)*(n+h)+d*d)-n;if(void 0===this.radius2_||"bevel"===t)return 2*u;const g=n*Math.sin(r),p=o-Math.sqrt(n*n-g*g),f=Math.sqrt(g*g+p*p)/g;return f<=i?2*Math.max(u,f*e/2-o-n):2*u}createRenderOptions(){let t,e=T,i=0,n=null,o=0,r=0;this.stroke_&&(t=this.stroke_.getColor(),null===t&&(t="#000"),t=b(t),r=this.stroke_.getWidth(),void 0===r&&(r=1),n=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),void 0===e&&(e=T),i=this.stroke_.getMiterLimit(),void 0===i&&(i=10));const s=this.calculateLineJoinSize_(e,r,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*a+s),lineDash:n,lineDashOffset:o,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=R),e.fillStyle=b(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=function(t){return Array.isArray(t)?t:E(t)}(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const e=k(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(Infinity===e)t.arc(0,0,i,0,2*Math.PI);else{const n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const o=this.angle_-Math.PI/2,r=2*Math.PI/e;for(let s=0;s<e;s++){const e=o+s*r,a=s%2==0?i:n;t.lineTo(a*Math.cos(e),a*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=R,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}var X=U;class Y extends X{constructor(t){super({points:Infinity,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Y({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}var z=Y;class J{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null}clone(){const t=this.getColor();return new J({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var K=J;class H{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new H({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var Z=H;class q{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=$,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new q({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=$,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function $(t){return t.getGeometry()}var Q=q;const tt={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var et=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||tt[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const it=6378137,nt=Math.PI*it,ot=[-nt,-nt,nt,nt],rt=[-180,-85,180,85],st=it*Math.log(Math.tan(Math.PI/2));class at extends et{constructor(t){super({code:t,units:"m",extent:ot,global:!0,worldExtent:rt,getPointResolution:function(t,e){return t/Math.cosh(e[1]/it)}})}}const lt=[new at("EPSG:3857"),new at("EPSG:102100"),new at("EPSG:102113"),new at("EPSG:900913"),new at("http://www.opengis.net/def/crs/EPSG/0/3857"),new at("http://www.opengis.net/gml/srs/epsg.xml#3857")],ct=[-180,-90,180,90],ht=6378137*Math.PI/180;class dt extends et{constructor(t,e){super({code:t,units:"degrees",extent:ct,axisOrientation:e,global:!0,metersPerUnit:ht,worldExtent:ct})}}const ut=[new dt("CRS:84"),new dt("EPSG:4326","neu"),new dt("urn:ogc:def:crs:OGC:1.3:CRS84"),new dt("urn:ogc:def:crs:OGC:2:84"),new dt("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new dt("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new dt("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let gt={},pt={};function ft(t,e,i){const n=t.getCode(),o=e.getCode();n in pt||(pt[n]={}),pt[n][o]=i}function yt(t,e,i){if(void 0!==e)for(let i=0,n=t.length;i<n;++i)e[i]=t[i];else e=t.slice();return e}function vt(t,e,i){if(void 0!==e&&t!==e){for(let i=0,n=t.length;i<n;++i)e[i]=t[i];t=e}return t}function mt(t){!function(t,e){gt[t]=e}(t.getCode(),t),ft(t,t,yt)}function _t(t){return"string"==typeof t?gt[e=t]||gt[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Ct(t){!function(t){t.forEach(mt)}(t),t.forEach(function(e){t.forEach(function(t){e!==t&&ft(e,t,yt)})})}function Pt(t,e,i){const n=function(t,e){return function(t,e){let i=function(t,e){let i;return t in pt&&e in pt[t]&&(i=pt[t][e]),i}(t.getCode(),e.getCode());return i||(i=vt),i}(_t(t),_t(e))}(e,i);return n(t,void 0,t.length)}var St,wt,xt;Ct(lt),Ct(ut),St=lt,wt=function(t,e,i){const n=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(n));for(let o=0;o<n;o+=i){e[o]=nt*t[o]/180;let i=it*Math.log(Math.tan(Math.PI*(+t[o+1]+90)/360));i>st?i=st:i<-st&&(i=-st),e[o+1]=i}return e},xt=function(t,e,i){const n=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(n));for(let o=0;o<n;o+=i)e[o]=180*t[o]/nt,e[o+1]=360*Math.atan(Math.exp(t[o+1]/it))/Math.PI-90;return e},ut.forEach(function(t){St.forEach(function(e){ft(t,e,wt),ft(e,t,xt)})});var Et,Mt=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,e)||this)._lib=void 0,i._map=void 0,i._container=void 0,i._projection="EPSG:3857",i._vectorSource=void 0,i._geoJSONReader=void 0,i._map=e.map,i._lib=e.lib,i._container=i._map.getViewport(),i._container.setAttribute("tabindex","0"),i}o(e,t);var i=e.prototype;return i.hexToRGB=function(t){return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16)}},i.getStyles=function(t,e){var i=this,n=t.getGeometry();if(n)return{Point:function(t){var n=t.getProperties(),o=e[n.mode]({type:"Feature",geometry:{type:"Point",coordinates:[]},properties:n});return new i._lib.Style({image:new z({radius:o.pointWidth,fill:new K({color:o.pointColor}),stroke:new Z({color:o.pointOutlineColor,width:o.pointOutlineWidth})})})},LineString:function(t){var n=t.getProperties(),o=e[n.mode]({type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:n});return new i._lib.Style({stroke:new i._lib.Stroke({color:o.lineStringColor,width:o.lineStringWidth})})},Polygon:function(t){var n=t.getProperties(),o=e[n.mode]({type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:n}),r=i.hexToRGB(o.polygonFillColor),s=r.r,a=r.g,l=r.b;return new Q({stroke:new Z({color:o.polygonOutlineColor,width:o.polygonOutlineWidth}),fill:new K({color:"rgba("+s+","+a+","+l+","+o.polygonFillOpacity+")"})})}}[n.getType()](t)},i.clearLayers=function(){this._vectorSource&&this._vectorSource.clear()},i.addFeature=function(t){if(!this._vectorSource||!this._geoJSONReader)throw new Error("Vector Source not initalised");var e=this._geoJSONReader.readFeature(t,{featureProjection:this._projection});this._vectorSource.addFeature(e)},i.removeFeature=function(t){if(!this._vectorSource)throw new Error("Vector Source not initalised");var e=this._vectorSource.getFeatureById(t);e&&this._vectorSource.removeFeature(e)},i.getLngLatFromEvent=function(t){var e=this.getContainerXYPosition(t),i=e.containerX,n=e.containerY;try{return this.unproject(i,n)}catch(t){return null}},i.getMapContainer=function(){return this._container},i.setDraggability=function(t){this._map.getInteractions().forEach(function(e){"DragPan"===e.constructor.name&&e.setActive(t)})},i.project=function(t,e){var i=this._map.getPixelFromCoordinate(Pt([t,e],"EPSG:4326","EPSG:3857"));return{x:i[0],y:i[1]}},i.unproject=function(t,e){var i=function(t,e){const i=Pt(t,"EPSG:3857","EPSG:4326"),n=i[0];return(n<-180||n>180)&&(i[0]=function(t,e){const i=t%360;return 360*i<0?i+360:i}(n+180)-180),i}(this._map.getCoordinateFromPixel([t,e]));return{lng:i[0],lat:i[1]}},i.setCursor=function(t){"unset"===t?this.getMapContainer().style.removeProperty("cursor"):this.getMapContainer().style.cursor=t},i.setDoubleClickToZoom=function(t){this._map.getInteractions().forEach(function(e){"DoubleClickZoom"===e.constructor.name&&e.setActive(t)})},i.render=function(t,e){var i=this;if(this._vectorSource){if(!this._vectorSource)throw new Error("Vector Layer source has disappeared");t.deletedIds.forEach(function(t){i.removeFeature(t)}),t.updated.forEach(function(t){i.removeFeature(t.id),i.addFeature(t)}),t.created.forEach(function(t){i.addFeature(t)})}else{this._geoJSONReader=new this._lib.GeoJSON;var n=this._geoJSONReader.readFeatures({type:"FeatureCollection",features:[].concat(t.created,t.updated,t.unchanged)},{featureProjection:this._projection}),o=new this._lib.VectorSource({features:n});this._vectorSource=o;var r=new this._lib.VectorLayer({source:o,style:function(t){return i.getStyles(t,e)}});this._map.addLayer(r)}},i.clear=function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())},e}(c),bt="selected",Dt="midPoint",It="closingPoint";function kt(t){return Boolean(t&&"object"==typeof t&&null!==t&&!Array.isArray(t))}function Ot(t){if(!function(t){return"number"==typeof t&&!isNaN(new Date(t).valueOf())}(t))throw new Error("updatedAt and createdAt are not valid timestamps");return!0}!function(t){t.Drawing="drawing",t.Select="select",t.Static="static",t.Render="render"}(Et||(Et={}));var Ft=/*#__PURE__*/function(){var t=e.prototype;function e(t){this._state=void 0,this._styles=void 0,this.behaviors=[],this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=Et.Drawing,this.mode="base",this._state="unregistered",this._styles=t&&t.styles?n({},t.styles):{},this.pointerDistance=t&&t.pointerDistance||40,this.coordinatePrecision=t&&t.coordinatePrecision||9}return t.registerBehaviors=function(t){},t.setDrawing=function(){if("started"!==this._state)throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"},t.setStarted=function(){if("stopped"!==this._state&&"registered"!==this._state&&"drawing"!==this._state&&"selecting"!==this._state)throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)},t.setStopped=function(){if("started"!==this._state)throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)},t.register=function(t){if("unregistered"!==this._state)throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=t.store,this.store.registerOnChange(t.onChange),this.setDoubleClickToZoom=t.setDoubleClickToZoom,this.project=t.project,this.unproject=t.unproject,this.onSelect=t.onSelect,this.onDeselect=t.onDeselect,this.setCursor=t.setCursor,this.onStyleChange=t.onChange,this.onFinish=t.onFinish,this.registerBehaviors({mode:t.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:this.coordinatePrecision})},t.validateFeature=function(t){return function(t){var e;if(kt(t))if(t.id)if("string"!=typeof t.id||36!==t.id.length)e="Feature must have UUID4 id";else if(kt(t.geometry))if(kt(t.properties))if("string"==typeof t.geometry.type&&["Polygon","LineString","Point"].includes(t.geometry.type))if(Array.isArray(t.geometry.coordinates)){if(!t.properties.mode||"string"!=typeof t.properties.mode)throw new Error("Feature does not have a valid mode property")}else e="Feature coordinates is not an array";else e="Feature is not Point, LineString or Polygon";else e="Feature has no properties";else e="Feature has no geometry";else e="Feature has no id";else e="Feature is not object";if(e)throw new Error(e);return!0}(t)},t.onFinish=function(t){},t.onDeselect=function(t){},t.onSelect=function(t){},t.onKeyDown=function(t){},t.onKeyUp=function(t){},t.onMouseMove=function(t){},t.onClick=function(t){},t.onDragStart=function(t,e){},t.onDrag=function(t,e){},t.onDragEnd=function(t,e){},t.getHexColorStylingValue=function(t,e,i){return this.getStylingValue(t,e,i)},t.getNumericStylingValue=function(t,e,i){return this.getStylingValue(t,e,i)},t.getStylingValue=function(t,e,i){return void 0===t?e:"function"==typeof t?t(i):t},i(e,[{key:"state",get:function(){return this._state},set:function(t){throw new Error("Please use the modes lifecycle methods")}},{key:"styles",get:function(){return this._styles},set:function(t){if("object"!=typeof t)throw new Error("Styling must be an object");this.onStyleChange([],"styling"),this._styles=t}}]),e}();function Lt(t,e){var i=function(t){return t*Math.PI/180},n=i(t[1]),o=i(t[0]),r=i(e[1]),s=r-n,a=i(e[0])-o,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(n)*Math.cos(r)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3}function Wt(t){return t%360*Math.PI/180}function At(t){return t%(2*Math.PI)*180/Math.PI}function Gt(t){for(var e,i,n,o,r,a,l,c,h=t.center,d=t.radiusKilometers,u=t.coordinatePrecision,g=t.steps?t.steps:64,p=[],f=0;f<g;f++){var y=(i=d,n=-360*f/g,o=Wt((e=h)[0]),r=Wt(e[1]),a=Wt(n),l=function(t){return t/6371.0088}(i),c=Math.asin(Math.sin(r)*Math.cos(l)+Math.cos(r)*Math.sin(l)*Math.cos(a)),[At(o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(r),Math.cos(l)-Math.sin(r)*Math.sin(c))),At(c)]);p.push([s(y[0],u),s(y[1],u)])}return p.push(p[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[p]},properties:{}}}function Bt(t){var e;if("Polygon"===t.geometry.type)e=t.geometry.coordinates;else{if("LineString"!==t.geometry.type)throw new Error("Self intersects only accepts Polygons and LineStrings");e=[t.geometry.coordinates]}for(var i=[],n=0;n<e.length;n++)for(var o=0;o<e[n].length-1;o++)for(var r=0;r<e.length;r++)for(var s=0;s<e[r].length-1;s++)l(n,o,r,s);return i.length>0;function a(t){return t<0||t>1}function l(t,n,o,r){var s,l=e[t][n],c=e[t][n+1],h=e[o][r],d=e[o][r+1],u=function(t,e,i,n){if(Nt(t,i)||Nt(t,n)||Nt(e,i)||Nt(n,i))return null;var o=t[0],r=t[1],s=e[0],a=e[1],l=i[0],c=i[1],h=n[0],d=n[1],u=(o-s)*(c-d)-(r-a)*(l-h);return 0===u?null:[((o*a-r*s)*(l-h)-(o-s)*(l*d-c*h))/u,((o*a-r*s)*(c-d)-(r-a)*(l*d-c*h))/u]}(l,c,h,d);null!==u&&(s=d[0]!==h[0]?(u[0]-h[0])/(d[0]-h[0]):(u[1]-h[1])/(d[1]-h[1]),a(c[0]!==l[0]?(u[0]-l[0])/(c[0]-l[0]):(u[1]-l[1])/(c[1]-l[1]))||a(s)||(u.toString(),i.push(u)))}}function Nt(t,e){return t[0]===e[0]&&t[1]===e[1]}function jt(t,e){return 2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&Infinity!==t[0]&&Infinity!==t[1]&&(n=t[0])>=-180&&n<=180&&(i=t[1])>=-90&&i<=90&&Vt(t[0])<=e&&Vt(t[1])<=e;var i,n}function Vt(t){for(var e=1,i=0;Math.round(t*e)/e!==t;)e*=10,i++;return i}function Rt(t,e){return"Polygon"===t.geometry.type&&1===t.geometry.coordinates.length&&t.geometry.coordinates[0].length>=4&&t.geometry.coordinates[0].every(function(t){return jt(t,e)})&&(i=t.geometry.coordinates[0][0])[0]===(n=t.geometry.coordinates[0][t.geometry.coordinates[0].length-1])[0]&&i[1]===n[1];var i,n}function Tt(t,e){return Rt(t,e)&&!Bt(t)}var Ut=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="circle",i.center=void 0,i.clickCount=0,i.currentCircleId=void 0,i.keyEvents=void 0,i.cursors=void 0;var o={start:"crosshair"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,null===(null==e?void 0:e.keyEvents))i.keyEvents={cancel:null,finish:null};else{var r={cancel:"Escape",finish:"Enter"};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i}o(e,t);var i=e.prototype;return i.close=function(){if(this.currentCircleId){var t=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),this.onFinish(t)}},i.start=function(){this.setStarted(),this.setCursor(this.cursors.start)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onClick=function(t){if(0===this.clickCount){this.center=[t.lng,t.lat];var e=Gt({center:this.center,radiusKilometers:1e-5,coordinatePrecision:this.coordinatePrecision}),i=this.store.create([{geometry:e.geometry,properties:{mode:this.mode}}]);this.currentCircleId=i[0],this.clickCount++,this.setDrawing()}else this.close()},i.onMouseMove=function(t){if(1===this.clickCount&&this.center&&this.currentCircleId){var e=Lt(this.center,[t.lng,t.lat]),i=Gt({center:this.center,radiusKilometers:e,coordinatePrecision:this.coordinatePrecision});this.store.updateGeometry([{id:this.currentCircleId,geometry:i.geometry}])}},i.onKeyDown=function(){},i.onKeyUp=function(t){t.key===this.keyEvents.cancel?this.cleanUp():t.key===this.keyEvents.finish&&this.close()},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.cleanUp=function(){try{this.currentCircleId&&this.store.delete([this.currentCircleId])}catch(t){}this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted()},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===t.type&&"Polygon"===t.geometry.type&&t.properties.mode===this.mode?(e.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,e.polygonFillColor,t),e.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,e.polygonOutlineColor,t),e.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,e.polygonOutlineWidth,t),e.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,e.polygonFillOpacity,t),e):e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&e.properties.mode===this.mode&&Tt(e,this.coordinatePrecision)},e}(Ft),Xt=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="freehand",i.startingClick=!1,i.currentId=void 0,i.closingPointId=void 0,i.minDistance=void 0,i.keyEvents=void 0,i.cursors=void 0;var o={start:"crosshair",close:"pointer"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,i.minDistance=e&&e.minDistance||20,null===(null==e?void 0:e.keyEvents))i.keyEvents={cancel:null,finish:null};else{var r={cancel:"Escape",finish:"Enter"};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i}o(e,t);var i=e.prototype;return i.close=function(){if(this.currentId){var t=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,"drawing"===this.state&&this.setStarted(),this.onFinish(t)}},i.start=function(){this.setStarted(),this.setCursor(this.cursors.start)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onMouseMove=function(t){if(this.currentId&&!1!==this.startingClick){var e=this.store.getGeometryCopy(this.currentId),i=e.coordinates[0][e.coordinates[0].length-2],n=this.project(i[0],i[1]),o=a({x:n.x,y:n.y},{x:t.containerX,y:t.containerY}),r=e.coordinates[0][0],s=this.project(r[0],r[1]),l=a({x:s.x,y:s.y},{x:t.containerX,y:t.containerY});this.setCursor(l<this.pointerDistance?this.cursors.close:this.cursors.start),o<this.minDistance||(e.coordinates[0].pop(),this.store.updateGeometry([{id:this.currentId,geometry:{type:"Polygon",coordinates:[[].concat(e.coordinates[0],[[t.lng,t.lat],e.coordinates[0][0]])]}}]))}},i.onClick=function(t){if(!1===this.startingClick){var e=this.store.create([{geometry:{type:"Polygon",coordinates:[[[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat]]]},properties:{mode:this.mode}},{geometry:{type:"Point",coordinates:[t.lng,t.lat]},properties:{mode:this.mode}}]),i=e[1];return this.currentId=e[0],this.closingPointId=i,this.startingClick=!0,void this.setDrawing()}this.close()},i.onKeyDown=function(){},i.onKeyUp=function(t){t.key===this.keyEvents.cancel?this.cleanUp():t.key===this.keyEvents.finish&&this.close()},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.cleanUp=function(){try{this.currentId&&this.store.delete([this.currentId]),this.closingPointId&&this.store.delete([this.closingPointId])}catch(t){}this.closingPointId=void 0,this.currentId=void 0,this.startingClick=!1,"drawing"===this.state&&this.setStarted()},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===t.type&&"Polygon"===t.geometry.type&&t.properties.mode===this.mode?(e.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,e.polygonFillColor,t),e.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,e.polygonOutlineColor,t),e.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,e.polygonOutlineWidth,t),e.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,e.polygonFillOpacity,t),e):"Feature"===t.type&&"Point"===t.geometry.type&&t.properties.mode===this.mode?(e.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,e.pointWidth,t),e.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,e.pointColor,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,e.pointOutlineColor,t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,t),e):e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&e.properties.mode===this.mode&&Rt(e,this.coordinatePrecision)},e}(Ft),Yt=Math.PI/180,zt=180/Math.PI,Jt=/*#__PURE__*/function(){function t(t){this.coordinatePrecision=void 0,this.coords=void 0,this.length=void 0,this.coordinatePrecision=t,this.coords=[],this.length=0}return t.prototype.moveTo=function(t){this.length++,this.coords.push([s(t[0],this.coordinatePrecision),s(t[1],this.coordinatePrecision)])},t}(),Kt=/*#__PURE__*/function(){function t(t){var e=t.properties;this.geometries=void 0,this.properties=void 0,this.properties=e||{},this.geometries=[]}return t.prototype.toJSON=function(){if(1===this.geometries.length){var t=this.geometries[0].coords;if(t[0][0]&&!isNaN(t[0][0])&&t[0][1]&&!isNaN(t[0][1]))return{geometry:{type:"LineString",coordinates:t},type:"Feature",properties:this.properties}}return null},t}(),Ht=/*#__PURE__*/function(){function t(t,e,i){if(this.g=void 0,this.start=void 0,this.end=void 0,this.properties=void 0,!t||void 0===t[0]||void 0===t[1])throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e[0]||void 0===e[1])throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start={lng:t[0],lat:t[1],x:Yt*t[0],y:Yt*t[1]},this.end={lng:e[0],lat:e[1],x:Yt*e[0],y:Yt*e[1]},this.properties=i||{};var n=this.start.x-this.end.x,o=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t+" and "+e+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)}var e=t.prototype;return e.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),i=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+i*Math.cos(this.end.y)*Math.cos(this.end.x),o=e*Math.cos(this.start.y)*Math.sin(this.start.x)+i*Math.cos(this.end.y)*Math.sin(this.end.x),r=e*Math.sin(this.start.y)+i*Math.sin(this.end.y),s=zt*Math.atan2(r,Math.sqrt(Math.pow(n,2)+Math.pow(o,2)));return[zt*Math.atan2(o,n),s]},e.arc=function(t,e){var i=[];if(!t||t<=2)i.push([this.start.lng,this.start.lat]),i.push([this.end.lng,this.end.lat]);else for(var n=1/(t-1),o=0;o<t;++o){var r=this.interpolate(n*o);i.push(r)}for(var s=!1,a=0,l=e&&e.offset?e.offset:10,c=180-l,h=-180+l,d=360-l,u=1;u<i.length;++u){var g=i[u-1][0],p=i[u][0],f=Math.abs(p-g);f>d&&(p>c&&g<h||g>c&&p<h)?s=!0:f>a&&(a=f)}var y=[];if(s&&a<l){var v=[];y.push(v);for(var m=0;m<i.length;++m){var _=i[m][0];if(m>0&&Math.abs(_-i[m-1][0])>d){var C=i[m-1][0],P=i[m-1][1],S=i[m][0],w=i[m][1];if(C>-180&&C<h&&180===S&&m+1<i.length&&i[m-1][0]>-180&&i[m-1][0]<h){v.push([-180,i[m][1]]),m++,v.push([i[m][0],i[m][1]]);continue}if(C>c&&C<180&&-180===S&&m+1<i.length&&i[m-1][0]>c&&i[m-1][0]<180){v.push([180,i[m][1]]),m++,v.push([i[m][0],i[m][1]]);continue}if(C<h&&S>c){var x=C;C=S,S=x;var E=P;P=w,w=E}if(C>c&&S<h&&(S+=360),C<=180&&S>=180&&C<S){var M=(180-C)/(S-C),b=M*w+(1-M)*P;v.push([i[m-1][0]>c?180:-180,b]),(v=[]).push([i[m-1][0]>c?-180:180,b]),y.push(v)}else y.push(v=[]);v.push([_,i[m][1]])}else v.push([i[m][0],i[m][1]])}}else{var D=[];y.push(D);for(var I=0;I<i.length;++I)D.push([i[I][0],i[I][1]])}for(var k=new Kt({properties:this.properties}),O=0;O<y.length;++O){var F=new Jt(e.coordinatePrecision);k.geometries.push(F);for(var L=y[O],W=0;W<L.length;++W)F.moveTo(L[W])}return k},t}(),Zt=function(t){var e=t.store,i=t.mode,n=t.project,o=t.unproject,r=t.pointerDistance,s=t.coordinatePrecision;this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.store=e,this.mode=i,this.project=n,this.unproject=o,this.pointerDistance=r,this.coordinatePrecision=s},qt=/*#__PURE__*/function(t){function e(e,i,n){var o;return(o=t.call(this,e)||this).config=void 0,o.pixelDistance=void 0,o.clickBoundingBox=void 0,o.getSnappableCoordinate=function(t,e){return o.getSnappableEnds(t,function(t){return Boolean(!t.properties||t.properties.mode!==o.mode||!e||t.id!==e)})},o.config=e,o.pixelDistance=i,o.clickBoundingBox=n,o}return o(e,t),e.prototype.getSnappableEnds=function(t,e){var i=this,n=this.clickBoundingBox.create(t),o=this.store.search(n,e),r={coord:void 0,minDist:Infinity};return o.forEach(function(e){var n;if("LineString"===e.geometry.type){var o=(n=e.geometry.coordinates)[0],s=i.pixelDistance.measure(t,o);s<r.minDist&&s<i.pointerDistance&&(r.coord=o);var a=n[n.length-1],l=i.pixelDistance.measure(t,a);l<r.minDist&&l<i.pointerDistance&&(r.coord=a)}}),r.coord},e}(Zt),$t=/*#__PURE__*/function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype.measure=function(t,e){var i=this.project(e[0],e[1]);return a({x:i.x,y:i.y},{x:t.containerX,y:t.containerY})},e}(Zt);function Qt(t){var e=t.unproject,i=t.point,n=t.pointerDistance/2,o=i.x,r=i.y;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[e(o-n,r-n),e(o+n,r-n),e(o+n,r+n),e(o-n,r+n),e(o-n,r-n)].map(function(t){return[t.lng,t.lat]})]}}}var te=/*#__PURE__*/function(t){function e(e){return t.call(this,e)||this}return o(e,t),e.prototype.create=function(t){return Qt({unproject:this.unproject,point:{x:t.containerX,y:t.containerY},pointerDistance:this.pointerDistance})},e}(Zt),ee=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="greatcircle",i.currentCoordinate=0,i.currentId=void 0,i.closingPointId=void 0,i.keyEvents=void 0,i.snappingEnabled=void 0,i.cursors=void 0,i.snapping=void 0;var o={start:"crosshair",close:"pointer"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,i.snappingEnabled=!(!e||void 0===e.snapping)&&e.snapping,null===(null==e?void 0:e.keyEvents))i.keyEvents={cancel:null,finish:null};else{var r={cancel:"Escape",finish:"Enter"};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i}o(e,t);var i=e.prototype;return i.close=function(){if(this.currentId){var t=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,"drawing"===this.state&&this.setStarted(),this.onFinish(t)}},i.registerBehaviors=function(t){this.snapping=new qt(t,new $t(t),new te(t))},i.start=function(){this.setStarted(),this.setCursor(this.cursors.start)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onMouseMove=function(t){if(this.setCursor(this.cursors.start),(this.currentId||0!==this.currentCoordinate)&&this.currentId&&1===this.currentCoordinate&&this.closingPointId){var e=this.currentId&&this.snappingEnabled&&this.snapping.getSnappableCoordinate(t,this.currentId)||[t.lng,t.lat];this.store.updateGeometry([{id:this.closingPointId,geometry:{type:"Point",coordinates:e}}]);var i=this.store.getGeometryCopy(this.currentId);i.coordinates.pop();var n=function(t){var e=t.start,i=t.end,n=t.options||{};if("object"!=typeof n)throw new Error("options argument is invalid, must be of type object");var o=n.properties,r=n.numberOfPoints,s=void 0===r?100:r,a=n.offset,l=void 0===a?10:a,c=n.coordinatePrecision,h=void 0===c?9:c;return new Ht(e,i,void 0===o?{}:o).arc(s,{offset:l,coordinatePrecision:h}).toJSON()}({start:i.coordinates[0],end:e,options:{coordinatePrecision:this.coordinatePrecision}});n&&this.store.updateGeometry([{id:this.currentId,geometry:n.geometry}])}},i.onClick=function(t){if(0===this.currentCoordinate){var e=this.snappingEnabled&&this.snapping.getSnappableCoordinate(t)||[t.lng,t.lat],i=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode}}]);this.currentId=i[0];var n=this.store.create([{geometry:{type:"Point",coordinates:e},properties:{mode:this.mode}}]);this.closingPointId=n[0],this.currentCoordinate++,this.setDrawing()}else 1===this.currentCoordinate&&this.currentId&&(this.setCursor("pointer"),this.close())},i.onKeyDown=function(){},i.onKeyUp=function(t){t.key===this.keyEvents.cancel&&this.cleanUp(),t.key===this.keyEvents.finish&&this.close()},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.cleanUp=function(){try{this.currentId&&this.store.delete([this.currentId]),this.closingPointId&&this.store.delete([this.closingPointId])}catch(t){}this.closingPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted()},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===t.type&&"LineString"===t.geometry.type&&t.properties.mode===this.mode?(e.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,e.lineStringColor,t),e.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,e.lineStringWidth,t),e):"Feature"===t.type&&"Point"===t.geometry.type&&t.properties.mode===this.mode?(e.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,e.pointColor,t),e.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,e.pointWidth,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,"#ffffff",t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,t),e):e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&"LineString"===e.geometry.type&&e.properties.mode===this.mode&&e.geometry.coordinates.length>=2},e}(Ft),ie=/*#__PURE__*/function(t){function e(e,i,n){var o;return(o=t.call(this,e)||this).config=void 0,o.pixelDistance=void 0,o.clickBoundingBox=void 0,o.getSnappableCoordinateFirstClick=function(t){return o.getSnappable(t,function(t){return Boolean(t.properties&&t.properties.mode===o.mode)})},o.getSnappableCoordinate=function(t,e){return o.getSnappable(t,function(t){return Boolean(t.properties&&t.properties.mode===o.mode&&t.id!==e)})},o.config=e,o.pixelDistance=i,o.clickBoundingBox=n,o}return o(e,t),e.prototype.getSnappable=function(t,e){var i=this,n=this.clickBoundingBox.create(t),o=this.store.search(n,e),r={coord:void 0,minDist:Infinity};return o.forEach(function(e){var n;if("Polygon"===e.geometry.type)n=e.geometry.coordinates[0];else{if("LineString"!==e.geometry.type)return;n=e.geometry.coordinates}n.forEach(function(e){var n=i.pixelDistance.measure(t,e);n<r.minDist&&n<i.pointerDistance&&(r.coord=e)})}),r.coord},e}(Zt),ne=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="linestring",i.currentCoordinate=0,i.currentId=void 0,i.closingPointId=void 0,i.allowSelfIntersections=void 0,i.keyEvents=void 0,i.snappingEnabled=void 0,i.cursors=void 0,i.mouseMove=!1,i.snapping=void 0;var o={start:"crosshair",close:"pointer"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,i.snappingEnabled=!(!e||void 0===e.snapping)&&e.snapping,i.allowSelfIntersections=!e||void 0===e.allowSelfIntersections||e.allowSelfIntersections,null===(null==e?void 0:e.keyEvents))i.keyEvents={cancel:null,finish:null};else{var r={cancel:"Escape",finish:"Enter"};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i}o(e,t);var i=e.prototype;return i.close=function(){if(this.currentId){var t=this.store.getGeometryCopy(this.currentId);t.coordinates.pop(),this.store.updateGeometry([{id:this.currentId,geometry:{type:"LineString",coordinates:[].concat(t.coordinates)}}]);var e=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,"drawing"===this.state&&this.setStarted(),this.onFinish(e)}},i.registerBehaviors=function(t){this.snapping=new ie(t,new $t(t),new te(t))},i.start=function(){this.setStarted(),this.setCursor(this.cursors.start)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onMouseMove=function(t){if(this.mouseMove=!0,this.setCursor(this.cursors.start),this.currentId&&0!==this.currentCoordinate){var e=this.store.getGeometryCopy(this.currentId);e.coordinates.pop();var i=this.snappingEnabled&&this.snapping.getSnappableCoordinate(t,this.currentId)||[t.lng,t.lat];if(this.closingPointId){var n=e.coordinates[e.coordinates.length-1],o=this.project(n[0],n[1]);a({x:o.x,y:o.y},{x:t.containerX,y:t.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}this.store.updateGeometry([{id:this.currentId,geometry:{type:"LineString",coordinates:[].concat(e.coordinates,[i])}}])}},i.onClick=function(t){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(t),this.mouseMove=!1;var e=this.currentId&&this.snappingEnabled&&this.snapping.getSnappableCoordinate(t,this.currentId)||[t.lng,t.lat];if(0===this.currentCoordinate){var i=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode}}]);this.currentId=i[0],this.currentCoordinate++,this.setDrawing()}else if(1===this.currentCoordinate&&this.currentId){var n=this.store.getGeometryCopy(this.currentId),o=this.store.create([{geometry:{type:"Point",coordinates:[].concat(e)},properties:{mode:this.mode}}]);this.closingPointId=o[0],this.setCursor(this.cursors.close),this.store.updateGeometry([{id:this.currentId,geometry:{type:"LineString",coordinates:[n.coordinates[0],e,e]}}]),this.currentCoordinate++}else if(this.currentId){var r=this.store.getGeometryCopy(this.currentId),s=r.coordinates[r.coordinates.length-2],l=this.project(s[0],s[1]);if(a({x:l.x,y:l.y},{x:t.containerX,y:t.containerY})<this.pointerDistance)this.close();else{var c={type:"LineString",coordinates:[].concat(r.coordinates,[e])};if(!this.allowSelfIntersections&&Bt({type:"Feature",geometry:c,properties:{}}))return;this.closingPointId&&(this.setCursor(this.cursors.close),this.store.updateGeometry([{id:this.currentId,geometry:c},{id:this.closingPointId,geometry:{type:"Point",coordinates:r.coordinates[r.coordinates.length-1]}}]),this.currentCoordinate++)}}},i.onKeyDown=function(){},i.onKeyUp=function(t){t.key===this.keyEvents.cancel&&this.cleanUp(),t.key===this.keyEvents.finish&&this.close()},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.cleanUp=function(){try{this.currentId&&this.store.delete([this.currentId]),this.closingPointId&&this.store.delete([this.closingPointId])}catch(t){}this.closingPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted()},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===t.type&&"LineString"===t.geometry.type&&t.properties.mode===this.mode?(e.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,e.lineStringColor,t),e.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,e.lineStringWidth,t),e):"Feature"===t.type&&"Point"===t.geometry.type&&t.properties.mode===this.mode?(e.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,e.pointColor,t),e.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,e.pointWidth,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,"#ffffff",t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,t),e):e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&"LineString"===e.geometry.type&&e.properties.mode===this.mode&&e.geometry.coordinates.length>=2},e}(Ft);function oe(t,e){return"Point"===t.geometry.type&&jt(t.geometry.coordinates,e)}var re=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="point",i.cursors=void 0;var o={create:"crosshair"};return i.cursors=e&&e.cursors?n({},o,e.cursors):o,i}o(e,t);var i=e.prototype;return i.start=function(){this.setStarted(),this.setCursor(this.cursors.create)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onClick=function(t){if(!this.store)throw new Error("Mode must be registered first");var e=this.store.create([{geometry:{type:"Point",coordinates:[t.lng,t.lat]},properties:{mode:this.mode}}]);this.onFinish(e[0])},i.onMouseMove=function(){},i.onKeyDown=function(){},i.onKeyUp=function(){},i.cleanUp=function(){},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===t.type&&"Point"===t.geometry.type&&t.properties.mode===this.mode&&(e.pointWidth=this.getNumericStylingValue(this.styles.pointWidth,e.pointWidth,t),e.pointColor=this.getHexColorStylingValue(this.styles.pointColor,e.pointColor,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.pointOutlineColor,e.pointOutlineColor,t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.pointOutlineWidth,2,t)),e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&e.properties.mode===this.mode&&oe(e,this.coordinatePrecision)},e}(Ft);function se(t,e){return t[0]===e[0]&&t[1]===e[1]}var ae=/*#__PURE__*/function(t){function e(e,i){var n;return(n=t.call(this,e)||this).config=void 0,n.pixelDistance=void 0,n._startEndPoints=[],n.config=e,n.pixelDistance=i,n}o(e,t);var n=e.prototype;return n.create=function(t,e){var i,n;if(this.ids.length)throw new Error("Opening and closing points already creating");if(t.length<=3)throw new Error("Requires at least 4 cooridnates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:t[0]},properties:(i={mode:e},i[It]=!0,i)},{geometry:{type:"Point",coordinates:t[t.length-2]},properties:(n={mode:e},n[It]=!0,n)}])},n.delete=function(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])},n.update=function(t){if(2!==this.ids.length)throw new Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:t[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:t[t.length-3]}}])},n.isClosingPoint=function(t){var e=this.store.getGeometryCopy(this.ids[0]),i=this.store.getGeometryCopy(this.ids[1]),n=this.pixelDistance.measure(t,e.coordinates),o=this.pixelDistance.measure(t,i.coordinates);return{isClosing:n<this.pointerDistance,isPreviousClosing:o<this.pointerDistance}},i(e,[{key:"ids",get:function(){return this._startEndPoints.concat()},set:function(t){}}]),e}(Zt),le=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="polygon",i.currentCoordinate=0,i.currentId=void 0,i.allowSelfIntersections=void 0,i.keyEvents=void 0,i.snappingEnabled=void 0,i.snapping=void 0,i.pixelDistance=void 0,i.closingPoints=void 0,i.cursors=void 0,i.mouseMove=!1;var o={start:"crosshair",close:"pointer"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,i.snappingEnabled=!(!e||void 0===e.snapping)&&e.snapping,i.allowSelfIntersections=!e||void 0===e.allowSelfIntersections||e.allowSelfIntersections,null===(null==e?void 0:e.keyEvents))i.keyEvents={cancel:null,finish:null};else{var r={cancel:"Escape",finish:"Enter"};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i}o(e,t);var i=e.prototype;return i.close=function(){if(this.currentId){var t=this.store.getGeometryCopy(this.currentId).coordinates[0];if(!(t.length<5)){this.store.updateGeometry([{id:this.currentId,geometry:{type:"Polygon",coordinates:[[].concat(t.slice(0,-2),[t[0]])]}}]);var e=this.currentId;this.currentCoordinate=0,this.currentId=void 0,this.closingPoints.delete(),"drawing"===this.state&&this.setStarted(),this.onFinish(e)}}},i.registerBehaviors=function(t){this.pixelDistance=new $t(t),this.snapping=new ie(t,this.pixelDistance,new te(t)),this.closingPoints=new ae(t,this.pixelDistance)},i.start=function(){this.setStarted(),this.setCursor(this.cursors.start)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onMouseMove=function(t){if(this.mouseMove=!0,this.setCursor(this.cursors.start),this.currentId&&0!==this.currentCoordinate){var e,i=this.snappingEnabled?this.snapping.getSnappableCoordinate(t,this.currentId):void 0,n=this.store.getGeometryCopy(this.currentId).coordinates[0];if(i&&(t.lng=i[0],t.lat=i[1]),1===this.currentCoordinate){var o=1/Math.pow(10,this.coordinatePrecision-1),r=Math.max(1e-6,o);e=[n[0],[t.lng,t.lat],[t.lng,t.lat-r],n[0]]}else if(2===this.currentCoordinate)e=[n[0],n[1],[t.lng,t.lat],n[0]];else{var s=this.closingPoints.isClosingPoint(t);s.isPreviousClosing||s.isClosing?(this.setCursor(this.cursors.close),e=[].concat(n.slice(0,-2),[n[0],n[0]])):e=[].concat(n.slice(0,-2),[[t.lng,t.lat],n[0]])}this.store.updateGeometry([{id:this.currentId,geometry:{type:"Polygon",coordinates:[e]}}])}},i.onClick=function(t){if(this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(t),this.mouseMove=!1,0===this.currentCoordinate){var e=this.snappingEnabled?this.snapping.getSnappableCoordinateFirstClick(t):void 0;e&&(t.lng=e[0],t.lat=e[1]);var i=this.store.create([{geometry:{type:"Polygon",coordinates:[[[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat]]]},properties:{mode:this.mode}}]);this.currentId=i[0],this.currentCoordinate++,this.setDrawing()}else if(1===this.currentCoordinate&&this.currentId){var n=this.snappingEnabled?this.snapping.getSnappableCoordinate(t,this.currentId):void 0;n&&(t.lng=n[0],t.lat=n[1]);var o=this.store.getGeometryCopy(this.currentId);if(se([t.lng,t.lat],o.coordinates[0][0]))return;this.store.updateGeometry([{id:this.currentId,geometry:{type:"Polygon",coordinates:[[o.coordinates[0][0],[t.lng,t.lat],[t.lng,t.lat],o.coordinates[0][0]]]}}]),this.currentCoordinate++}else if(2===this.currentCoordinate&&this.currentId){var r=this.snappingEnabled?this.snapping.getSnappableCoordinate(t,this.currentId):void 0;r&&(t.lng=r[0],t.lat=r[1]);var s=this.store.getGeometryCopy(this.currentId).coordinates[0];if(se([t.lng,t.lat],s[1]))return;2===this.currentCoordinate&&this.closingPoints.create(s,"polygon"),this.store.updateGeometry([{id:this.currentId,geometry:{type:"Polygon",coordinates:[[s[0],s[1],[t.lng,t.lat],[t.lng,t.lat],s[0]]]}}]),this.currentCoordinate++}else if(this.currentId){var a=this.snappingEnabled?this.snapping.getSnappableCoordinate(t,this.currentId):void 0,l=this.store.getGeometryCopy(this.currentId).coordinates[0],c=this.closingPoints.isClosingPoint(t);if(c.isPreviousClosing||c.isClosing)this.close();else{if(a&&(t.lng=a[0],t.lat=a[1]),se([t.lng,t.lat],l[this.currentCoordinate-1]))return;var h=(void 0===(d=[[].concat(l.slice(0,-1),[[t.lng,t.lat],l[0]])])&&(d=[[[0,0],[0,1],[1,1],[1,0],[0,0]]]),{type:"Feature",geometry:{type:"Polygon",coordinates:d},properties:{}});if(this.currentCoordinate>2&&!this.allowSelfIntersections&&Bt(h))return;this.store.updateGeometry([{id:this.currentId,geometry:h.geometry}]),this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(h.geometry.coordinates[0])}}var d},i.onKeyUp=function(t){t.key===this.keyEvents.cancel?this.cleanUp():t.key===this.keyEvents.finish&&this.close()},i.onKeyDown=function(){},i.onDragStart=function(){this.setCursor("unset")},i.onDrag=function(){},i.onDragEnd=function(){this.setCursor(this.cursors.start)},i.cleanUp=function(){try{this.currentId&&this.store.delete([this.currentId]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch(t){}this.currentId=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted()},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(t.properties.mode===this.mode){if("Polygon"===t.geometry.type)return e.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,e.polygonFillColor,t),e.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,e.polygonOutlineColor,t),e.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,e.polygonOutlineWidth,t),e.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,e.polygonFillOpacity,t),e.zIndex=10,e;if("Point"===t.geometry.type)return e.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,e.pointWidth,t),e.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,e.pointColor,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,e.pointOutlineColor,t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,t),e.zIndex=30,e}return e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&e.properties.mode===this.mode&&Rt(e,this.coordinatePrecision)},e}(Ft),ce=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).mode="rectangle",i.center=void 0,i.clickCount=0,i.currentRectangleId=void 0,i.keyEvents=void 0,i.cursors=void 0;var o={start:"crosshair"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,null===(null==e?void 0:e.keyEvents))i.keyEvents={cancel:null,finish:null};else{var r={cancel:"Escape",finish:"Enter"};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i}o(e,t);var i=e.prototype;return i.updateRectangle=function(t){if(1===this.clickCount&&this.center&&this.currentRectangleId){var e=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0];this.store.updateGeometry([{id:this.currentRectangleId,geometry:{type:"Polygon",coordinates:[[e,[t.lng,e[1]],[t.lng,t.lat],[e[0],t.lat],e]]}}])}},i.close=function(){var t=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),t&&this.onFinish(t)},i.start=function(){this.setStarted(),this.setCursor(this.cursors.start)},i.stop=function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")},i.onClick=function(t){if(0===this.clickCount){this.center=[t.lng,t.lat];var e=this.store.create([{geometry:{type:"Polygon",coordinates:[[[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat]]]},properties:{mode:this.mode}}]);this.currentRectangleId=e[0],this.clickCount++,this.setDrawing()}else this.updateRectangle(t),this.close()},i.onMouseMove=function(t){this.updateRectangle(t)},i.onKeyDown=function(){},i.onKeyUp=function(t){t.key===this.keyEvents.cancel?this.cleanUp():t.key===this.keyEvents.finish&&this.close()},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.cleanUp=function(){this.currentRectangleId&&this.store.delete([this.currentRectangleId]),this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted()},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===t.type&&"Polygon"===t.geometry.type&&t.properties.mode===this.mode?(e.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,e.polygonFillColor,t),e.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,e.polygonOutlineColor,t),e.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,e.polygonOutlineWidth,t),e.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,e.polygonFillOpacity,t),e):e},i.validateFeature=function(e){return!!t.prototype.validateFeature.call(this,e)&&e.properties.mode===this.mode&&Tt(e,this.coordinatePrecision)},e}(Ft),he=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,{styles:e.styles})||this).type=Et.Render,i.mode="render",i.mode=e.modeName,i}o(e,t);var i=e.prototype;return i.registerBehaviors=function(t){this.mode=t.mode},i.start=function(){this.setStarted()},i.stop=function(){this.setStopped()},i.onKeyUp=function(){},i.onKeyDown=function(){},i.onClick=function(){},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.onMouseMove=function(){},i.cleanUp=function(){},i.styleFeature=function(t){return{pointColor:this.getHexColorStylingValue(this.styles.pointColor,"#3f97e0",t),pointWidth:this.getNumericStylingValue(this.styles.pointWidth,6,t),pointOutlineColor:this.getHexColorStylingValue(this.styles.pointOutlineColor,"#ffffff",t),pointOutlineWidth:this.getNumericStylingValue(this.styles.pointOutlineWidth,0,t),polygonFillColor:this.getHexColorStylingValue(this.styles.polygonFillColor,"#3f97e0",t),polygonFillOpacity:this.getNumericStylingValue(this.styles.polygonFillOpacity,.3,t),polygonOutlineColor:this.getHexColorStylingValue(this.styles.polygonOutlineColor,"#3f97e0",t),polygonOutlineWidth:this.getNumericStylingValue(this.styles.polygonOutlineWidth,4,t),lineStringWidth:this.getNumericStylingValue(this.styles.lineStringWidth,4,t),lineStringColor:this.getHexColorStylingValue(this.styles.lineStringColor,"#3f97e0",t),zIndex:this.getNumericStylingValue(this.styles.zIndex,0,t)}},i.validateFeature=function(e){return t.prototype.validateFeature.call(this,e)&&(oe(e,this.coordinatePrecision)||Rt(e,this.coordinatePrecision)||function(t,e){return"LineString"===t.geometry.type&&t.geometry.coordinates.length>=2&&t.geometry.coordinates.every(function(t){return jt(t,e)})}(e,this.coordinatePrecision))},e}(Ft);function de(t,e,i,n,o){var r=n(t[0],t[1]),a=n(e[0],e[1]),l=o((r.x+a.x)/2,(r.y+a.y)/2),c=l.lat;return[s(l.lng,i),s(c,i)]}function ue(t,e,i,n){for(var o=[],r=0;r<t.length-1;r++){var s=de(t[r],t[r+1],e,i,n);o.push(s)}return o}var ge=/*#__PURE__*/function(t){function e(e,i){var n;return(n=t.call(this,e)||this).config=void 0,n.selectionPointBehavior=void 0,n._midPoints=[],n.config=e,n.selectionPointBehavior=i,n}o(e,t);var n=e.prototype;return n.insert=function(t,e){var i=this.store.getGeometryCopy(t),n=this.store.getPropertiesCopy(t),o=n.midPointFeatureId,r=n.midPointSegment,s=this.store.getGeometryCopy(o),a="Polygon"===s.type?s.coordinates[0]:s.coordinates;a.splice(r+1,0,i.coordinates),s.coordinates="Polygon"===s.type?[a]:a,this.store.updateGeometry([{id:o,geometry:s}]),this.store.delete([].concat(this._midPoints,this.selectionPointBehavior.ids)),this.create(a,o,e),this.selectionPointBehavior.create(a,s.type,o)},n.create=function(t,e,i){var n=this;if(!this.store.has(e))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(t,e,i,n,o){return ue(t,i,n,o).map(function(t,i){return{geometry:{type:"Point",coordinates:t},properties:e(i)}})}(t,function(t){var i;return(i={mode:n.mode})[Dt]=!0,i.midPointSegment=t,i.midPointFeatureId=e,i},i,this.config.project,this.config.unproject))},n.delete=function(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])},n.getUpdated=function(t){var e=this;if(0!==this._midPoints.length)return ue(t,this.coordinatePrecision,this.config.project,this.config.unproject).map(function(t,i){return{id:e._midPoints[i],geometry:{type:"Point",coordinates:t}}})},i(e,[{key:"ids",get:function(){return this._midPoints.concat()},set:function(t){}}]),e}(Zt),pe=/*#__PURE__*/function(t){function e(e){var i;return(i=t.call(this,e)||this)._selectionPoints=[],i}o(e,t);var n=e.prototype;return n.create=function(t,e,i){var n=this;this._selectionPoints=this.store.create(function(t,e,i){for(var n=[],o="Polygon"===e?t.length-1:t.length,r=0;r<o;r++)n.push({geometry:{type:"Point",coordinates:t[r]},properties:i(r)});return n}(t,e,function(t){return{mode:n.mode,selectionPoint:!0,selectionPointFeatureId:i,index:t}}))},n.delete=function(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])},n.getUpdated=function(t){if(0!==this._selectionPoints.length)return this._selectionPoints.map(function(e,i){return{id:e,geometry:{type:"Point",coordinates:t[i]}}})},n.getOneUpdated=function(t,e){if(void 0!==this._selectionPoints[t])return{id:this._selectionPoints[t],geometry:{type:"Point",coordinates:e}}},i(e,[{key:"ids",get:function(){return this._selectionPoints.concat()},set:function(t){}}]),e}(Zt);function fe(t,e){for(var i,n,o,r=!1,s=0,a=e.length;s<a;s++)for(var l=e[s],c=0,h=l.length,d=h-1;c<h;d=c++)(n=l[c])[1]>(i=t)[1]!=(o=l[d])[1]>i[1]&&i[0]<(o[0]-n[0])*(i[1]-n[1])/(o[1]-n[1])+n[0]&&(r=!r);return r}var ye=function(t,e,i){var n=function(t){return t*t},o=function(t,e){return n(t.x-e.x)+n(t.y-e.y)};return Math.sqrt(function(t,e,i){var n=o(e,i);if(0===n)return o(t,e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r=Math.max(0,Math.min(1,r)),o(t,{x:e.x+r*(i.x-e.x),y:e.y+r*(i.y-e.y)})}(t,e,i))},ve=/*#__PURE__*/function(t){function e(e,i,n){var o;return(o=t.call(this,e)||this).config=void 0,o.createClickBoundingBox=void 0,o.pixelDistance=void 0,o.config=e,o.createClickBoundingBox=i,o.pixelDistance=n,o}return o(e,t),e.prototype.find=function(t,e){for(var i=void 0,n=Infinity,o=void 0,r=Infinity,s=this.createClickBoundingBox.create(t),a=this.store.search(s),l=0;l<a.length;l++){var c=a[l],h=c.geometry;if("Point"===h.type){if(c.properties.selectionPoint||!e&&c.properties[Dt])continue;var d=this.pixelDistance.measure(t,h.coordinates);c.properties[Dt]&&d<this.pointerDistance&&d<r?(r=d,o=c):!c.properties[Dt]&&d<this.pointerDistance&&d<n&&(n=d,i=c)}else if("LineString"===h.type)for(var u=0;u<h.coordinates.length-1;u++){var g=h.coordinates[u],p=h.coordinates[u+1],f=ye({x:t.containerX,y:t.containerY},this.project(g[0],g[1]),this.project(p[0],p[1]));f<this.pointerDistance&&f<n&&(n=f,i=c)}else"Polygon"===h.type&&fe([t.lng,t.lat],h.coordinates)&&(n=0,i=c)}return{clickedFeature:i,clickedMidPoint:o}},e}(Zt),me=/*#__PURE__*/function(t){function e(e,i,n,o){var r;return(r=t.call(this,e)||this).config=void 0,r.featuresAtMouseEvent=void 0,r.selectionPoints=void 0,r.midPoints=void 0,r.draggedFeatureId=null,r.dragPosition=void 0,r.config=e,r.featuresAtMouseEvent=i,r.selectionPoints=n,r.midPoints=o,r}o(e,t);var i=e.prototype;return i.startDragging=function(t,e){this.draggedFeatureId=e,this.dragPosition=[t.lng,t.lat]},i.stopDragging=function(){this.draggedFeatureId=null,this.dragPosition=void 0},i.isDragging=function(){return null!==this.draggedFeatureId},i.canDrag=function(t,e){var i=this.featuresAtMouseEvent.find(t,!0).clickedFeature;return!(!i||i.id!==e)},i.drag=function(t){if(this.draggedFeatureId){var e=this.store.getGeometryCopy(this.draggedFeatureId),i=[t.lng,t.lat];if("Polygon"===e.type||"LineString"===e.type){var n,o;if(o="Polygon"===e.type?(n=e.coordinates[0]).length-1:(n=e.coordinates).length,!this.dragPosition)return!1;for(var r=0;r<o;r++){var a=n[r],l=[this.dragPosition[0]-i[0],this.dragPosition[1]-i[1]],c=s(a[0]-l[0],this.config.coordinatePrecision),h=s(a[1]-l[1],this.config.coordinatePrecision);if(c>180||c<-180||h>90||h<-90)return!1;n[r]=[c,h]}"Polygon"===e.type&&(n[n.length-1]=[n[0][0],n[0][1]]);var d=this.selectionPoints.getUpdated(n)||[],u=this.midPoints.getUpdated(n)||[];this.store.updateGeometry([{id:this.draggedFeatureId,geometry:e}].concat(d,u)),this.dragPosition=[t.lng,t.lat]}else"Point"===e.type&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:i}}]),this.dragPosition=[t.lng,t.lat])}},e}(Zt),_e=/*#__PURE__*/function(t){function e(e,i,n,o){var r;return(r=t.call(this,e)||this).config=void 0,r.pixelDistance=void 0,r.selectionPoints=void 0,r.midPoints=void 0,r.draggedCoordinate={id:null,index:-1},r.config=e,r.pixelDistance=i,r.selectionPoints=n,r.midPoints=o,r}o(e,t);var i=e.prototype;return i.getClosestCoordinate=function(t,e){var i,n={dist:Infinity,index:-1,isFirstOrLastPolygonCoord:!1};if("LineString"===e.type)i=e.coordinates;else{if("Polygon"!==e.type)return n;i=e.coordinates[0]}for(var o=0;o<i.length;o++){var r=this.pixelDistance.measure(t,i[o]);if(r<this.pointerDistance&&r<n.dist){var s="Polygon"===e.type&&(o===i.length-1||0===o);n.dist=r,n.index=s?0:o,n.isFirstOrLastPolygonCoord=s}}return n},i.getDraggableIndex=function(t,e){var i=this.store.getGeometryCopy(e),n=this.getClosestCoordinate(t,i);return-1===n.index?-1:n.index},i.drag=function(t,e){if(!this.draggedCoordinate.id)return!1;var i=this.draggedCoordinate.index,n=this.store.getGeometryCopy(this.draggedCoordinate.id),o="LineString"===n.type?n.coordinates:n.coordinates[0],r=[t.lng,t.lat];if(t.lng>180||t.lng<-180||t.lat>90||t.lat<-90)return!1;if("Polygon"!==n.type||i!==o.length-1&&0!==i)o[i]=r;else{var s=o.length-1;o[0]=r,o[s]=r}var a=this.selectionPoints.getOneUpdated(i,r),l=a?[a]:[],c=this.midPoints.getUpdated(o)||[];return!("Point"!==n.type&&!e&&Bt({type:"Feature",geometry:n,properties:{}})||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:n}].concat(l,c)),0))},i.isDragging=function(){return null!==this.draggedCoordinate.id},i.startDragging=function(t,e){this.draggedCoordinate={id:t,index:e}},i.stopDragging=function(){this.draggedCoordinate={id:null,index:-1}},e}(Zt);function Ce(t){var e=0,i=0,n=0;return("Polygon"===t.geometry.type?t.geometry.coordinates[0].slice(0,-1):t.geometry.coordinates).forEach(function(t){e+=t[0],i+=t[1],n++},!0),[e/n,i/n]}function Pe(t,e){var i=t,n=e,o=Wt(i[1]),r=Wt(n[1]),s=Wt(n[0]-i[0]);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);var a=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),l=(At(Math.atan2(s,a))+360)%360;return l>180?-(360-l):l}function Se(t,e,i){var n=e/6371008.8,o=t[0]*Math.PI/180,r=Wt(t[1]),s=Wt(i),a=n*Math.cos(s),l=r+a;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),h=Math.abs(c)>1e-11?a/c:Math.cos(r),d=[(180*(o+n*Math.sin(s)/h)/Math.PI+540)%360-180,180*l/Math.PI];return d[0]+=d[0]-t[0]>180?-360:t[0]-d[0]>180?360:0,d}function we(t,e){t[0]+=t[0]-e[0]>180?-360:e[0]-t[0]>180?360:0;var i=e[1]*Math.PI/180,n=t[1]*Math.PI/180,o=n-i,r=Math.abs(t[0]-e[0])*Math.PI/180;r>Math.PI&&(r-=2*Math.PI);var s=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),a=Math.abs(s)>1e-11?o/s:Math.cos(i);return 6371008.8*Math.sqrt(o*o+a*a*r*r)}var xe=/*#__PURE__*/function(t){function e(e,i,n){var o;return(o=t.call(this,e)||this).config=void 0,o.selectionPoints=void 0,o.midPoints=void 0,o.lastBearing=void 0,o.config=e,o.selectionPoints=i,o.midPoints=n,o}o(e,t);var i=e.prototype;return i.reset=function(){this.lastBearing=void 0},i.rotate=function(t,e){var i=this,n=this.store.getGeometryCopy(e);if("Polygon"===n.type||"LineString"===n.type){var o=[t.lng,t.lat],r=Pe(Ce({type:"Feature",geometry:n,properties:{}}),o);if(this.lastBearing){!function(t,e){if(0===e)return t;var i=Ce(t);("Polygon"===t.geometry.type?t.geometry.coordinates[0]:t.geometry.coordinates).forEach(function(t){var n=Pe(i,t)+e,o=we(i,t),r=Se(i,o,n);t[0]=r[0],t[1]=r[1]})}({type:"Feature",geometry:n,properties:{}},-(this.lastBearing-(r+180)));var a="Polygon"===n.type?n.coordinates[0]:n.coordinates;a.forEach(function(t){t[0]=s(t[0],i.coordinatePrecision),t[1]=s(t[1],i.coordinatePrecision)});var l=this.midPoints.getUpdated(a)||[],c=this.selectionPoints.getUpdated(a)||[];this.store.updateGeometry([{id:e,geometry:n}].concat(c,l)),this.lastBearing=r+180}else this.lastBearing=r+180}},e}(Zt),Ee=/*#__PURE__*/function(t){function e(e,i,n){var o;return(o=t.call(this,e)||this).config=void 0,o.selectionPoints=void 0,o.midPoints=void 0,o.lastDistance=void 0,o.config=e,o.selectionPoints=i,o.midPoints=n,o}o(e,t);var i=e.prototype;return i.reset=function(){this.lastDistance=void 0},i.scale=function(t,e){var i=this,n=this.store.getGeometryCopy(e);if("Polygon"===n.type||"LineString"===n.type){var o=[t.lng,t.lat],r=Lt(Ce({type:"Feature",geometry:n,properties:{}}),o);if(this.lastDistance){!function(t,e){if(1===e)return t;var i=Ce(t);("Polygon"===t.geometry.type?t.geometry.coordinates[0]:t.geometry.coordinates).forEach(function(t){var n=we(i,t),o=Pe(i,t),r=Se(i,n*e,o);t[0]=r[0],t[1]=r[1]})}({type:"Feature",geometry:n,properties:{}},1-(this.lastDistance-r)/r);var a="Polygon"===n.type?n.coordinates[0]:n.coordinates;a.forEach(function(t){t[0]=s(t[0],i.coordinatePrecision),t[1]=s(t[1],i.coordinatePrecision)});var l=this.midPoints.getUpdated(a)||[],c=this.selectionPoints.getUpdated(a)||[];this.store.updateGeometry([{id:e,geometry:n}].concat(c,l)),this.lastDistance=r}else this.lastDistance=r}},e}(Zt),Me=/*#__PURE__*/function(t){function e(e){var i;(i=t.call(this,e)||this).type=Et.Select,i.mode="select",i.dragEventThrottle=5,i.dragEventCount=0,i.selected=[],i.flags=void 0,i.keyEvents=void 0,i.selectionPoints=void 0,i.midPoints=void 0,i.featuresAtMouseEvent=void 0,i.pixelDistance=void 0,i.clickBoundingBox=void 0,i.dragFeature=void 0,i.dragCoordinate=void 0,i.rotateFeature=void 0,i.scaleFeature=void 0,i.cursors=void 0,i.flags=e&&e.flags?e.flags:{};var o={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};if(i.cursors=e&&e.cursors?n({},o,e.cursors):o,null===(null==e?void 0:e.keyEvents))i.keyEvents={deselect:null,delete:null,rotate:null,scale:null};else{var r={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]};i.keyEvents=e&&e.keyEvents?n({},r,e.keyEvents):r}return i.dragEventThrottle=e&&void 0!==e.dragEventThrottle&&e.dragEventThrottle||5,i}o(e,t);var i=e.prototype;return i.setSelecting=function(){if("started"!==this._state)throw new Error("Mode must be started to move to selecting state");this._state="selecting"},i.registerBehaviors=function(t){this.pixelDistance=new $t(t),this.clickBoundingBox=new te(t),this.featuresAtMouseEvent=new ve(t,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new pe(t),this.midPoints=new ge(t,this.selectionPoints),this.rotateFeature=new xe(t,this.selectionPoints,this.midPoints),this.scaleFeature=new Ee(t,this.selectionPoints,this.midPoints),this.dragFeature=new me(t,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints),this.dragCoordinate=new _e(t,this.pixelDistance,this.selectionPoints,this.midPoints)},i.deselect=function(){var t=this,e=this.selected.filter(function(e){return t.store.has(e)}).map(function(t){return{id:t,property:bt,value:!1}});this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()},i.deleteSelected=function(){this.store.delete(this.selected),this.selected=[]},i.onRightClick=function(t){var e=this;if(this.selectionPoints.ids.length){var i,n=Infinity;if(this.selectionPoints.ids.forEach(function(o){var r=e.store.getGeometryCopy(o),s=e.pixelDistance.measure(t,r.coordinates);s<e.pointerDistance&&s<n&&(n=s,i=e.store.getPropertiesCopy(o))}),i){var o=i.selectionPointFeatureId,r=i.index,s=this.store.getPropertiesCopy(o),a=this.flags[s.mode];if(a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.deletable){var l,c=this.store.getGeometryCopy(o);if("Polygon"===c.type){if((l=c.coordinates[0]).length<=4)return}else if("LineString"===c.type&&(l=c.coordinates).length<=3)return;l&&("Polygon"===c.type&&0===r||r===l.length-1?(l.shift(),l.pop(),l.push([l[0][0],l[0][1]])):l.splice(r,1),this.store.delete([].concat(this.midPoints.ids,this.selectionPoints.ids)),this.store.updateGeometry([{id:o,geometry:c}]),this.selectionPoints.create(l,c.type,o),a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.midpoints&&this.midPoints.create(l,o,this.coordinatePrecision))}}}},i.onLeftClick=function(t){var e=this.featuresAtMouseEvent.find(t,this.selected.length>0),i=e.clickedFeature,n=e.clickedMidPoint;if(this.selected.length&&n)this.midPoints.insert(n.id,this.coordinatePrecision);else if(i){var o=this.store.getPropertiesCopy(i.id),r=this.flags[o.mode];if(!r||!r.feature)return;var s=this.selected[0];if(s){if(s===i.id)return;this.deselect()}this.setCursor(this.cursors.pointerOver),this.selected=[i.id],this.store.updateProperty([{id:i.id,property:"selected",value:!0}]),this.onSelect(i.id);var a=this.store.getGeometryCopy(i.id),l=a.type,c=a.coordinates;if("LineString"!==l&&"Polygon"!==l)return;var h="LineString"===l?c:c[0];h&&r&&r.feature.coordinates&&(this.selectionPoints.create(h,l,i.id),r.feature.coordinates.midpoints&&this.midPoints.create(h,i.id,this.coordinatePrecision))}else if(this.selected.length)return void this.deselect()},i.start=function(){this.setStarted(),this.setSelecting()},i.stop=function(){this.cleanUp(),this.setStarted(),this.setStopped()},i.onClick=function(t){"right"!==t.button?"left"===t.button&&this.onLeftClick(t):this.onRightClick(t)},i.canScale=function(t){return this.keyEvents.scale&&this.keyEvents.scale.every(function(e){return t.heldKeys.includes(e)})},i.canRotate=function(t){return this.keyEvents.rotate&&this.keyEvents.rotate.every(function(e){return t.heldKeys.includes(e)})},i.preventDefaultKeyEvent=function(t){var e=this.canRotate(t),i=this.canScale(t);(e||i)&&t.preventDefault()},i.onKeyDown=function(t){this.preventDefaultKeyEvent(t)},i.onKeyUp=function(t){if(this.preventDefaultKeyEvent(t),this.keyEvents.delete&&t.key===this.keyEvents.delete){if(!this.selected.length)return;this.onDeselect(this.selected[0]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&t.key===this.keyEvents.deselect&&this.cleanUp()},i.cleanUp=function(){this.selected.length&&this.deselect()},i.onDragStart=function(t,e){if(this.selected.length){var i=this.store.getPropertiesCopy(this.selected[0]),n=this.flags[i.mode];if(n&&n.feature&&(n.feature.draggable||n.feature.coordinates&&n.feature.coordinates.draggable)){this.dragEventCount=0;var o=this.selected[0],r=this.dragCoordinate.getDraggableIndex(t,o);return n&&n.feature&&n.feature.coordinates&&n.feature.coordinates.draggable&&-1!==r?(this.setCursor(this.cursors.dragStart),this.dragCoordinate.startDragging(o,r),void e(!1)):n&&n.feature&&n.feature.draggable&&this.dragFeature.canDrag(t,o)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(t,o),void e(!1)):void 0}}},i.onDrag=function(t,e){var i=this.selected[0];if(i){var n=this.store.getPropertiesCopy(i),o=this.flags[n.mode],r=!0===(o&&o.feature&&o.feature.selfIntersectable);if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle!=0)return o&&o.feature&&o.feature.rotateable&&this.canRotate(t)?(e(!1),void this.rotateFeature.rotate(t,i)):o&&o.feature&&o.feature.scaleable&&this.canScale(t)?(e(!1),void this.scaleFeature.scale(t,i)):void(this.dragCoordinate.isDragging()?this.dragCoordinate.drag(t,r):this.dragFeature.isDragging()?this.dragFeature.drag(t):e(!0))}},i.onDragEnd=function(t,e){this.setCursor(this.cursors.dragEnd),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),e(!0)},i.onMouseMove=function(t){var e=this;if(this.selected.length){if(!this.dragFeature.isDragging()){var i=!1;this.midPoints.ids.forEach(function(n){if(!i){var o=e.store.getGeometryCopy(n);e.pixelDistance.measure(t,o.coordinates)<e.pointerDistance&&(i=!0)}});var n=!1;if(this.selectionPoints.ids.forEach(function(o){var r=e.store.getGeometryCopy(o);e.pixelDistance.measure(t,r.coordinates)<e.pointerDistance&&(i=!1,n=!0)}),i)this.setCursor(this.cursors.insertMidpoint);else{var o=this.featuresAtMouseEvent.find(t,!0).clickedFeature;this.setCursor(this.selected.length>0&&(o&&o.id===this.selected[0]||n)?this.cursors.pointerOver:"unset")}}}else this.setCursor("unset")},i.styleFeature=function(t){var e=n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(t.properties.mode===this.mode&&"Point"===t.geometry.type){if(t.properties.selectionPoint)return e.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,e.pointColor,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,e.pointOutlineColor,t),e.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,e.pointWidth,t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,t),e.zIndex=30,e;if(t.properties.midPoint)return e.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,e.pointColor,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,e.pointOutlineColor,t),e.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,t),e.zIndex=40,e}else if(t.properties[bt]){if("Polygon"===t.geometry.type)return e.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,e.polygonFillColor,t),e.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,e.polygonOutlineWidth,t),e.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,e.polygonOutlineColor,t),e.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,e.polygonFillOpacity,t),e.zIndex=10,e;if("LineString"===t.geometry.type)return e.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,e.lineStringColor,t),e.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,e.lineStringWidth,t),e.zIndex=10,e;if("Point"===t.geometry.type)return e.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,e.pointWidth,t),e.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,e.pointColor,t),e.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,e.pointOutlineColor,t),e.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,e.pointOutlineWidth,t),e.zIndex=10,e}return e},e}(Ft),be=/*#__PURE__*/function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).type=Et.Static,e.mode="static",e}o(e,t);var i=e.prototype;return i.start=function(){},i.stop=function(){},i.onKeyUp=function(){},i.onKeyDown=function(){},i.onClick=function(){},i.onDragStart=function(){},i.onDrag=function(){},i.onDragEnd=function(){},i.onMouseMove=function(){},i.cleanUp=function(){},i.styleFeature=function(){return n({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})},e}(Ft),De=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})};function Ie(t,e,i,n,o){for(;n>i;){if(n-i>600){var r=n-i+1,s=e-i+1,a=Math.log(r),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(r-l)/r)*(s-r/2<0?-1:1);Ie(t,e,Math.max(i,Math.floor(e-s*l/r+c)),Math.min(n,Math.floor(e+(r-s)*l/r+c)),o)}var h=t[e],d=i,u=n;for(ke(t,i,e),o(t[n],h)>0&&ke(t,i,n);d<u;){for(ke(t,d,u),d++,u--;o(t[d],h)<0;)d++;for(;o(t[u],h)>0;)u--}0===o(t[i],h)?ke(t,i,u):ke(t,++u,n),u<=e&&(i=u+1),e<=u&&(n=u-1)}}function ke(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Oe(t,e){Fe(t,0,t.children.length,e,t)}function Fe(t,e,i,n,o){o||(o=Ve([])),o.minX=Infinity,o.minY=Infinity,o.maxX=-Infinity,o.maxY=-Infinity;for(var r=e;r<i;r++){var s=t.children[r];Le(o,t.leaf?n(s):s)}return o}function Le(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function We(t,e){return t.minX-e.minX}function Ae(t,e){return t.minY-e.minY}function Ge(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Be(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ne(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function je(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Ve(t){return{children:t,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function Re(t,e,i,n,o){for(var r=[e,i];r.length;)if(!((i=r.pop())-(e=r.pop())<=n)){var s=e+Math.ceil((i-e)/n/2)*n;Ie(t,s,e,i,o),r.push(e,s,s,i)}}var Te=/*#__PURE__*/function(){function t(t){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}var e=t.prototype;return e.search=function(t){var e=this.data,i=[];if(!je(t,e))return i;for(var n=this.toBBox,o=[];e;){for(var r=0;r<e.children.length;r++){var s=e.children[r],a=e.leaf?n(s):s;je(t,a)&&(e.leaf?i.push(s):Ne(t,a)?this._all(s,i):o.push(s))}e=o.pop()}return i},e.collides=function(t){var e=this.data;if(je(t,e))for(var i=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],r=e.leaf?this.toBBox(o):o;if(je(t,r)){if(e.leaf||Ne(t,r))return!0;i.push(o)}}e=i.pop()}return!1},e.load=function(t){if(t.length<this._minEntries)for(var e=0;e<t.length;e++)this.insert(t[e]);else{var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i}},e.insert=function(t){this._insert(t,this.data.height-1)},e.clear=function(){this.data=Ve([])},e.remove=function(t){for(var e,i,n=this.data,o=this.toBBox(t),r=[],s=[],a=!1;n||r.length;){if(n||(n=r.pop(),i=r[r.length-1],e=s.pop(),a=!0),n.leaf){var l=n.children.indexOf(t);-1!==l&&(n.children.splice(l,1),r.push(n),this._condense(r))}a||n.leaf||!Ne(n,o)?i?(e++,n=i.children[e],a=!1):n=null:(r.push(n),s.push(e),e=0,i=n,n=n.children[0])}},e.toBBox=function(t){return t},e.compareMinX=function(t,e){return t.minX-e.minX},e.compareMinY=function(t,e){return t.minY-e.minY},e._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},e._build=function(t,e,i,n){var o,r=i-e+1,s=this._maxEntries;if(r<=s)return Oe(o=Ve(t.slice(e,i+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,n-1))),(o=Ve([])).leaf=!1,o.height=n;var a=Math.ceil(r/s),l=a*Math.ceil(Math.sqrt(s));Re(t,e,i,l,this.compareMinX);for(var c=e;c<=i;c+=l){var h=Math.min(c+l-1,i);Re(t,c,h,a,this.compareMinY);for(var d=c;d<=h;d+=a){var u=Math.min(d+a-1,h);o.children.push(this._build(t,d,u,n-1))}}return Oe(o,this.toBBox),o},e._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var o=Infinity,r=Infinity,s=void 0,a=0;a<e.children.length;a++){var l=e.children[a],c=Ge(l),h=(d=t,u=l,(Math.max(u.maxX,d.maxX)-Math.min(u.minX,d.minX))*(Math.max(u.maxY,d.maxY)-Math.min(u.minY,d.minY))-c);h<r?(r=h,o=c<o?c:o,s=l):h===r&&c<o&&(o=c,s=l)}e=s||e.children[0]}var d,u;return e},e._insert=function(t,e,i){var n=i?t:this.toBBox(t),o=[],r=this._chooseSubtree(n,this.data,e,o);for(r.children.push(t),Le(r,n);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(n,o,e)},e._split=function(t,e){var i=t[e],n=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,n);var r=this._chooseSplitIndex(i,o,n),s=Ve(i.children.splice(r,i.children.length-r));s.height=i.height,s.leaf=i.leaf,Oe(i,this.toBBox),Oe(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)},e._splitRoot=function(t,e){this.data=Ve([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Oe(this.data,this.toBBox)},e._chooseSplitIndex=function(t,e,i){for(var n,o,r,s,a,l,c,h=Infinity,d=Infinity,u=e;u<=i-e;u++){var g=Fe(t,0,u,this.toBBox),p=Fe(t,u,i,this.toBBox),f=(o=g,r=p,s=Math.max(o.minX,r.minX),a=Math.max(o.minY,r.minY),l=Math.min(o.maxX,r.maxX),c=Math.min(o.maxY,r.maxY),Math.max(0,l-s)*Math.max(0,c-a)),y=Ge(g)+Ge(p);f<h?(h=f,n=u,d=y<d?y:d):f===h&&y<d&&(d=y,n=u)}return n||i-e},e._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:We,o=t.leaf?this.compareMinY:Ae;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,o)&&t.children.sort(n)},e._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var o=this.toBBox,r=Fe(t,0,e,o),s=Fe(t,i-e,i,o),a=Be(r)+Be(s),l=e;l<i-e;l++){var c=t.children[l];Le(r,t.leaf?o(c):c),a+=Be(r)}for(var h=i-e-1;h>=e;h--){var d=t.children[h];Le(s,t.leaf?o(d):d),a+=Be(s)}return a},e._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)Le(e[n],t)},e._condense=function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():Oe(t[i],this.toBBox)},t}(),Ue=/*#__PURE__*/function(){function t(t){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new Te(t&&t.maxEntries?t.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}var e=t.prototype;return e.setMaps=function(t,e){this.idToNode.set(String(t.id),e),this.nodeToId.set(e,String(t.id))},e.toBBox=function(t){var e,i=[],n=[];if("Polygon"===t.geometry.type)e=t.geometry.coordinates[0];else if("LineString"===t.geometry.type)e=t.geometry.coordinates;else{if("Point"!==t.geometry.type)throw new Error("Not a valid feature to turn into a bounding box");e=[t.geometry.coordinates]}for(var o=0;o<e.length;o++)n.push(e[o][1]),i.push(e[o][0]);var r=Math.min.apply(Math,n),s=Math.max.apply(Math,n);return{minX:Math.min.apply(Math,i),minY:r,maxX:Math.max.apply(Math,i),maxY:s}},e.insert=function(t){if(this.idToNode.get(String(t.id)))throw new Error("Feature already exists");var e=this.toBBox(t);this.setMaps(t,e),this.tree.insert(e)},e.load=function(t){var e=this,i=[],n=new Set;t.forEach(function(t){var o=e.toBBox(t);if(e.setMaps(t,o),n.has(String(t.id)))throw new Error("Duplicate feature ID found "+t.id);n.add(String(t.id)),i.push(o)}),this.tree.load(i)},e.update=function(t){this.remove(t.id);var e=this.toBBox(t);this.setMaps(t,e),this.tree.insert(e)},e.remove=function(t){var e=this.idToNode.get(t);if(!e)throw new Error(t+" not inserted into the spatial index");this.tree.remove(e)},e.clear=function(){this.tree.clear()},e.search=function(t){var e=this;return this.tree.search(this.toBBox(t)).map(function(t){return e.nodeToId.get(t)})},e.collides=function(t){return this.tree.collides(this.toBBox(t))},t}(),Xe=/*#__PURE__*/function(){function t(t){this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=function(){},this.store={},this.spatialIndex=new Ue,this.tracked=!t||!1!==t.tracked}var e=t.prototype;return e.getId=function(){return De()},e.clone=function(t){return JSON.parse(JSON.stringify(t))},e.has=function(t){return Boolean(this.store[t])},e.load=function(t,e){var i=this;if(0!==t.length){var n=this.clone(t);n.forEach(function(t){t.id||(t.id=De()),i.tracked&&(t.properties.createdAt?Ot(t.properties.createdAt):t.properties.createdAt=+new Date,t.properties.updatedAt?Ot(t.properties.updatedAt):t.properties.updatedAt=+new Date)});var o=[];n.forEach(function(t){if(e&&!e(t))throw new Error("Feature is not "+t.id+" valid: "+JSON.stringify(t));i.store[t.id]=t,o.push(t.id)}),this.spatialIndex.load(n),this._onChange(o,"create")}},e.search=function(t,e){var i=this,n=this.spatialIndex.search(t).map(function(t){return i.store[t]});return this.clone(e?n.filter(e):n)},e.registerOnChange=function(t){this._onChange=function(e,i){t(e,i)}},e.getGeometryCopy=function(t){var e=this.store[t];if(!e)throw new Error("No feature with this id ("+t+"), can not get geometry copy");return this.clone(e.geometry)},e.getPropertiesCopy=function(t){var e=this.store[t];if(!e)throw new Error("No feature with this id ("+t+"), can not get properties copy");return this.clone(e.properties)},e.updateProperty=function(t){var e=this,i=[];t.forEach(function(t){var n=t.id,o=t.property,r=t.value,s=e.store[n];if(!s)throw new Error("No feature with this ("+n+"), can not update geometry");i.push(n),s.properties[o]=r,e.tracked&&(s.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update")},e.updateGeometry=function(t){var e=this,i=[];t.forEach(function(t){var n=t.id,o=t.geometry;i.push(n);var r=e.store[n];if(!r)throw new Error("No feature with this ("+n+"), can not update geometry");r.geometry=e.clone(o),e.spatialIndex.update(r),e.tracked&&(r.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update")},e.create=function(t){var e=this,i=[];return t.forEach(function(t){var o,r=t.geometry,s=t.properties,a=n({},s);e.tracked&&(o=+new Date,s?(a.createdAt="number"==typeof s.createdAt?s.createdAt:o,a.updatedAt="number"==typeof s.updatedAt?s.updatedAt:o):a={createdAt:o,updatedAt:o});var l=e.getId(),c={id:l,type:"Feature",geometry:r,properties:a};e.store[l]=c,e.spatialIndex.insert(c),i.push(l)}),this._onChange&&this._onChange([].concat(i),"create"),i},e.delete=function(t){var e=this;t.forEach(function(t){if(!e.store[t])throw new Error("No feature with this id, can not delete");delete e.store[t],e.spatialIndex.remove(t)}),this._onChange&&this._onChange([].concat(t),"delete")},e.copyAll=function(){var t=this;return this.clone(Object.keys(this.store).map(function(e){return t.store[e]}))},e.clear=function(){this.store={},this.spatialIndex.clear()},e.size=function(){return Object.keys(this.store).length},t}(),Ye={TerraDrawBaseDrawMode:Ft,TerraDrawBaseAdapter:c};t.TerraDraw=/*#__PURE__*/function(){function t(t){var e=this;this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=t.adapter,this._mode=new be;var i=new Set,o=t.modes.reduce(function(t,e){if(i.has(e.mode))throw new Error("There is already a "+e.mode+" mode provided");return i.add(e.mode),t[e.mode]=e,t},{}),r=Object.keys(o);if(0===r.length)throw new Error("No modes provided");r.forEach(function(t){if(o[t].type===Et.Select){if(e._instanceSelectMode)throw new Error("only one type of select mode can be provided");e._instanceSelectMode=t}}),this._modes=n({},o,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[]},this._store=new Xe;var s=function(t){var i=[],n=e._store.copyAll().filter(function(e){return!t.includes(e.id)||(i.push(e),!1)});return{changed:i,unchanged:n}},a=function(t){e._enabled&&e._eventListeners.finish.forEach(function(e){e(t)})},l=function(t,i){if(e._enabled){e._eventListeners.change.forEach(function(e){e(t,i)});var n=s(t),o=n.changed,r=n.unchanged;"create"===i?e._adapter.render({created:o,deletedIds:[],unchanged:r,updated:[]},e.getModeStyles()):"update"===i?e._adapter.render({created:[],deletedIds:[],unchanged:r,updated:o},e.getModeStyles()):"delete"===i?e._adapter.render({created:[],deletedIds:t,unchanged:r,updated:[]},e.getModeStyles()):"styling"===i&&e._adapter.render({created:[],deletedIds:[],unchanged:r,updated:[]},e.getModeStyles())}},c=function(t){if(e._enabled){e._eventListeners.select.forEach(function(e){e(t)});var i=s([t]);e._adapter.render({created:[],deletedIds:[],unchanged:i.unchanged,updated:i.changed},e.getModeStyles())}},h=function(t){if(e._enabled){e._eventListeners.deselect.forEach(function(t){t()});var i=s([t]),n=i.changed;n&&e._adapter.render({created:[],deletedIds:[],unchanged:i.unchanged,updated:n},e.getModeStyles())}};Object.keys(this._modes).forEach(function(t){e._modes[t].register({mode:t,store:e._store,setCursor:e._adapter.setCursor.bind(e._adapter),project:e._adapter.project.bind(e._adapter),unproject:e._adapter.unproject.bind(e._adapter),setDoubleClickToZoom:e._adapter.setDoubleClickToZoom.bind(e._adapter),onChange:l,onSelect:c,onDeselect:h,onFinish:a})})}var e=t.prototype;return e.checkEnabled=function(){if(!this._enabled)throw new Error("Terra Draw is not enabled")},e.getModeStyles=function(){var t=this,e={};return Object.keys(this._modes).forEach(function(i){e[i]=function(e){return t._instanceSelectMode&&e.properties[bt]?t._modes[t._instanceSelectMode].styleFeature.bind(t._modes[t._instanceSelectMode])(e):t._modes[i].styleFeature.bind(t._modes[i])(e)}}),e},e.featuresAtLocation=function(t,e){var i=t.lng,n=t.lat,o=e&&void 0!==e.pointerDistance?e.pointerDistance:30,r=!e||void 0===e.ignoreSelectFeatures||e.ignoreSelectFeatures,s=this._adapter.unproject.bind(this._adapter),l=this._adapter.project.bind(this._adapter),c=l(i,n),h=Qt({unproject:s,point:c,pointerDistance:o});return this._store.search(h).filter(function(t){if(r&&(t.properties[Dt]||t.properties.selectionPoint))return!1;if("Point"===t.geometry.type){var e=t.geometry.coordinates,s=l(e[0],e[1]);return a(c,s)<o}if("LineString"===t.geometry.type){for(var h=t.geometry.coordinates,d=0;d<h.length-1;d++){var u=h[d],g=h[d+1];if(ye(c,l(u[0],u[1]),l(g[0],g[1]))<o)return!0}return!1}return!!fe([i,n],t.geometry.coordinates)||void 0})},e.setModeStyles=function(t,e){if(this.checkEnabled(),!this._modes[t])throw new Error("No mode with this name present");this._modes[t].styles=e},e.getSnapshot=function(){return this._store.copyAll()},e.clear=function(){this.checkEnabled(),this._adapter.clear()},e.getMode=function(){return this._mode.mode},e.setMode=function(t){if(this.checkEnabled(),!this._modes[t])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[t],this._mode.start()},e.removeFeatures=function(t){this.checkEnabled(),this._store.delete(t)},e.addFeatures=function(t){var e=this;this.checkEnabled(),0!==t.length&&this._store.load(t,function(t){if(Boolean(t&&"object"==typeof t&&"properties"in t&&"object"==typeof t.properties&&null!==t.properties&&"mode"in t.properties)){var i=e._modes[t.properties.mode];return!!i&&i.validateFeature.bind(i)(t)}return!1})},e.start=function(){var t=this;this._enabled=!0,this._adapter.register({getState:function(){return t._mode.state},onClick:function(e){t._mode.onClick(e)},onMouseMove:function(e){t._mode.onMouseMove(e)},onKeyDown:function(e){t._mode.onKeyDown(e)},onKeyUp:function(e){t._mode.onKeyUp(e)},onDragStart:function(e,i){t._mode.onDragStart(e,i)},onDrag:function(e,i){t._mode.onDrag(e,i)},onDragEnd:function(e,i){t._mode.onDragEnd(e,i)},onClear:function(){t._mode.cleanUp(),t._store.clear()}})},e.getFeaturesAtLngLat=function(t,e){return this.featuresAtLocation({lng:t.lng,lat:t.lat},e)},e.getFeaturesAtPointerEvent=function(t,e){var i=this._adapter.getLngLatFromEvent.bind(this._adapter)(t);return null===i?[]:this.featuresAtLocation(i,e)},e.stop=function(){this._enabled=!1,this._adapter.unregister()},e.on=function(t,e){var i=this._eventListeners[t];i.includes(e)||i.push(e)},e.off=function(t,e){var i=this._eventListeners[t];i.includes(e)&&i.splice(i.indexOf(e),1)},i(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){throw new Error("Enabled is read only")}}]),t}(),t.TerraDrawCircleMode=Ut,t.TerraDrawExtend=Ye,t.TerraDrawFreehandMode=Xt,t.TerraDrawGoogleMapsAdapter=h,t.TerraDrawGreatCircleMode=ee,t.TerraDrawLeafletAdapter=d,t.TerraDrawLineStringMode=ne,t.TerraDrawMapLibreGLAdapter=g,t.TerraDrawMapboxGLAdapter=u,t.TerraDrawOpenLayersAdapter=Mt,t.TerraDrawPointMode=re,t.TerraDrawPolygonMode=le,t.TerraDrawRectangleMode=ce,t.TerraDrawRenderMode=he,t.TerraDrawSelectMode=Me});
//# sourceMappingURL=terra-draw.umd.js.map
